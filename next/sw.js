const CACHE_NAME="kaya-v3",RUNTIME_CACHE="kaya-runtime-v3",PRECACHE_ASSETS=["./","./index.html","./manifest.json","./favicon.svg","./icon-192.png","./icon-512.png"];self.addEventListener("install",e=>{e.waitUntil(caches.open(CACHE_NAME).then(e=>(console.log("[SW] Precaching app shell"),e.addAll(PRECACHE_ASSETS))))}),self.addEventListener("activate",e=>{e.waitUntil(caches.keys().then(e=>Promise.all(e.filter(e=>e!==CACHE_NAME&&e!==RUNTIME_CACHE).map(e=>(console.log("[SW] Deleting old cache:",e),caches.delete(e))))))}),self.addEventListener("fetch",e=>{let{request:t}=e,n=new URL(t.url);if("GET"===t.method&&"blob:"!==n.protocol){if(n.origin!==self.location.origin){("https://fonts.googleapis.com"===n.origin||"https://fonts.gstatic.com"===n.origin)&&e.respondWith(caches.open(RUNTIME_CACHE).then(e=>e.match(t).then(n=>n||fetch(t).then(n=>(e.put(t,n.clone()),n)))));return}if(!(n.pathname.endsWith(".wasm")||n.pathname.endsWith(".mjs")||n.pathname.endsWith(".onnx")||n.pathname.includes("/wasm/")||n.pathname.includes("/static/wasm/")||n.pathname.endsWith("sw.js")||n.pathname.endsWith("coi-serviceworker.js"))&&"worker"!==t.destination&&"sharedworker"!==t.destination){if("image"===t.destination&&!n.pathname.includes("/static/"))return void e.respondWith(caches.open(RUNTIME_CACHE).then(e=>e.match(t).then(n=>n||fetch(t).then(n=>(n.ok&&e.put(t,n.clone()),n)))));if("audio"===t.destination||n.pathname.includes("/assets/")&&n.pathname.endsWith(".mp3"))return void e.respondWith(fetch(t).then(e=>{let n=e.headers.get("content-type")||"";if(e.ok&&n.includes("audio")){let n=e.clone();caches.open(RUNTIME_CACHE).then(e=>{e.put(t,n)})}return e}).catch(()=>caches.open(RUNTIME_CACHE).then(e=>e.match(t))));if("navigate"===t.mode)return void e.respondWith(fetch(t).then(e=>{let n=e.clone();return caches.open(CACHE_NAME).then(e=>{e.put(t,n)}),e}).catch(()=>caches.match(t).then(e=>e||caches.match("./index.html"))))}}}),self.addEventListener("message",e=>{e.data&&"SKIP_WAITING"===e.data.type&&self.skipWaiting()});