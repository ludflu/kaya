/*! For license information please see ort.webgpu.bundle.min.mjs.LICENSE.txt */
let e;var t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,o,s,u,l,f,d,c,p,h,y,m,g,b,w,v,C,T,_,E,x,A,O,I,S,U,B,R,M,j,L,P,$,k,D=(e=function(e){if("u">typeof require)return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')},"u">typeof require?require:"u">typeof Proxy?new Proxy(e,{get:(e,t)=>("u">typeof require?require:e)[t]}):e),N=(e,t)=>()=>(e&&(t=e(e=0)),t),W=(e,r)=>{for(var i in r)t(e,i,{get:r[i],enumerable:!0})},G=e=>((e,o,s,u)=>{if(o&&"object"==typeof o||"function"==typeof o)for(let l of i(o))n.call(e,l)||l===s||t(e,l,{get:()=>o[l],enumerable:!(u=r(o,l))||u.enumerable});return e})(t({},"__esModule",{value:!0}),e),F=N(()=>{"use strict";o=new Map,s=[],u=(e,t,r)=>{if(t&&"function"==typeof t.init&&"function"==typeof t.createInferenceSessionHandler){let i=o.get(e);if(void 0===i)o.set(e,{backend:t,priority:r});else{if(i.priority>r)return;if(i.priority===r&&i.backend!==t)throw Error(`cannot register backend "${e}" using priority ${r}`)}if(r>=0){let t=s.indexOf(e);-1!==t&&s.splice(t,1);for(let t=0;t<s.length;t++)if(o.get(s[t]).priority<=r)return void s.splice(t,0,e);s.push(e)}return}throw TypeError("not a valid backend")},l=async e=>{let t=o.get(e);if(!t)return"backend not found.";if(t.initialized)return t.backend;if(t.aborted)return t.error;{let r=!!t.initPromise;try{return r||(t.initPromise=t.backend.init(e)),await t.initPromise,t.initialized=!0,t.backend}catch(e){return r||(t.error=`${e}`,t.aborted=!0),t.error}finally{delete t.initPromise}}},f=async e=>{let t=e.executionProviders||[],r=t.map(e=>"string"==typeof e?e:e.name),i=0===r.length?s:r,n,o=[],u=new Set;for(let e of i){let t=await l(e);"string"==typeof t?o.push({name:e,err:t}):(n||(n=t),n===t&&u.add(e))}if(!n)throw Error(`no available backend found. ERR: ${o.map(e=>`[${e.name}] ${e.err}`).join(", ")}`);for(let{name:e,err:t}of o)r.includes(e)&&console.warn(`removing requested execution provider "${e}" from session options because it is not available: ${t}`);let f=t.filter(e=>u.has("string"==typeof e?e:e.name));return[n,new Proxy(e,{get:(e,t)=>"executionProviders"===t?f:Reflect.get(e,t)})]}}),V=N(()=>{"use strict";F()}),z=N(()=>{"use strict";d="1.23.2"}),H=N(()=>{"use strict";z(),c="warning",Object.defineProperty(p={wasm:{},webgl:{},webgpu:{},versions:{common:d},set logLevel(a){if(void 0!==a){if("string"!=typeof a||-1===["verbose","info","warning","error","fatal"].indexOf(a))throw Error(`Unsupported logging level: ${a}`);c=a}},get logLevel(){return c}},"logLevel",{enumerable:!0})}),q=N(()=>{"use strict";H(),h=p}),Y=N(()=>{"use strict";y=(e,t)=>{let r="u">typeof document?document.createElement("canvas"):new OffscreenCanvas(1,1);r.width=e.dims[3],r.height=e.dims[2];let i=r.getContext("2d");if(null!=i){let n,o;t?.tensorLayout!==void 0&&"NHWC"===t.tensorLayout?(n=e.dims[2],o=e.dims[3]):(n=e.dims[3],o=e.dims[2]);let s=t?.format!==void 0?t.format:"RGB",u=t?.norm,l,f;void 0===u||void 0===u.mean?l=[255,255,255,255]:"number"==typeof u.mean?l=[u.mean,u.mean,u.mean,u.mean]:(l=[u.mean[0],u.mean[1],u.mean[2],0],void 0!==u.mean[3]&&(l[3]=u.mean[3])),void 0===u||void 0===u.bias?f=[0,0,0,0]:"number"==typeof u.bias?f=[u.bias,u.bias,u.bias,u.bias]:(f=[u.bias[0],u.bias[1],u.bias[2],0],void 0!==u.bias[3]&&(f[3]=u.bias[3]));let d=o*n,c=0,p=d,h=2*d,y=-1;"RGBA"===s?(c=0,p=d,h=2*d,y=3*d):"RGB"===s?(c=0,p=d,h=2*d):"RBG"===s&&(c=0,h=d,p=2*d);for(let t=0;t<o;t++)for(let r=0;r<n;r++)i.fillStyle="rgba("+(e.data[c++]-f[0])*l[0]+","+(e.data[p++]-f[1])*l[1]+","+(e.data[h++]-f[2])*l[2]+","+(-1===y?255:(e.data[y++]-f[3])*l[3])+")",i.fillRect(r,t,1,1);if("toDataURL"in r)return r.toDataURL();throw Error("toDataURL is not supported")}throw Error("Can not access image data")},m=(e,t)=>{let r="u">typeof document?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),i;if(null!=r){let n,o,s;t?.tensorLayout!==void 0&&"NHWC"===t.tensorLayout?(n=e.dims[2],o=e.dims[1],s=e.dims[3]):(n=e.dims[3],o=e.dims[2],s=e.dims[1]);let u=void 0!==t&&void 0!==t.format?t.format:"RGB",l=t?.norm,f,d;void 0===l||void 0===l.mean?f=[255,255,255,255]:"number"==typeof l.mean?f=[l.mean,l.mean,l.mean,l.mean]:(f=[l.mean[0],l.mean[1],l.mean[2],255],void 0!==l.mean[3]&&(f[3]=l.mean[3])),void 0===l||void 0===l.bias?d=[0,0,0,0]:"number"==typeof l.bias?d=[l.bias,l.bias,l.bias,l.bias]:(d=[l.bias[0],l.bias[1],l.bias[2],0],void 0!==l.bias[3]&&(d[3]=l.bias[3]));let c=o*n;if(void 0!==t&&(void 0!==t.format&&4===s&&"RGBA"!==t.format||3===s&&"RGB"!==t.format&&"BGR"!==t.format))throw Error("Tensor format doesn't match input tensor dims");let p=0,h=1,y=2,m=3,g=0,b=c,w=2*c,v=-1;"RGBA"===u?(g=0,b=c,w=2*c,v=3*c):"RGB"===u?(g=0,b=c,w=2*c):"RBG"===u&&(g=0,w=c,b=2*c),i=r.createImageData(n,o);for(let t=0;t<o*n;p+=4,h+=4,y+=4,m+=4,t++)i.data[p]=(e.data[g++]-d[0])*f[0],i.data[h]=(e.data[b++]-d[1])*f[1],i.data[y]=(e.data[w++]-d[2])*f[2],i.data[m]=-1===v?255:(e.data[v++]-d[3])*f[3]}else throw Error("Can not access image data");return i}}),Z=N(()=>{"use strict";K(),g=(e,t)=>{if(void 0===e)throw Error("Image buffer must be defined");if(void 0===t.height||void 0===t.width)throw Error("Image height and width must be defined");if("NHWC"===t.tensorLayout)throw Error("NHWC Tensor layout is not supported yet");let{height:r,width:i}=t,n=t.norm??{mean:255,bias:0},o,s;o="number"==typeof n.mean?[n.mean,n.mean,n.mean,n.mean]:[n.mean[0],n.mean[1],n.mean[2],n.mean[3]??255],s="number"==typeof n.bias?[n.bias,n.bias,n.bias,n.bias]:[n.bias[0],n.bias[1],n.bias[2],n.bias[3]??0];let u=void 0!==t.format?t.format:"RGBA",l=void 0!==t.tensorFormat&&void 0!==t.tensorFormat?t.tensorFormat:"RGB",f=r*i,d=new Float32Array("RGBA"===l?4*f:3*f),c=4,p=0,h=1,y=2,m=3,g=0,b=f,w=2*f,v=-1;"RGB"===u&&(c=3,p=0,h=1,y=2,m=-1),"RGBA"===l?v=3*f:"RBG"===l?(g=0,w=f,b=2*f):"BGR"===l&&(w=0,b=f,g=2*f);for(let t=0;t<f;t++,p+=c,y+=c,h+=c,m+=c)d[g++]=(e[p]+s[0])/o[0],d[b++]=(e[h]+s[1])/o[1],d[w++]=(e[y]+s[2])/o[2],-1!==v&&-1!==m&&(d[v++]=(e[m]+s[3])/o[3]);return"RGBA"===l?new S("float32",d,[1,4,r,i]):new S("float32",d,[1,3,r,i])},b=async(e,t)=>{let r="u">typeof HTMLImageElement&&e instanceof HTMLImageElement,i="u">typeof ImageData&&e instanceof ImageData,n="u">typeof ImageBitmap&&e instanceof ImageBitmap,o="string"==typeof e,s,u=t??{},l=()=>{if("u">typeof document)return document.createElement("canvas");if("u">typeof OffscreenCanvas)return new OffscreenCanvas(1,1);throw Error("Canvas is not supported")},f=e=>"u">typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||e instanceof OffscreenCanvas?e.getContext("2d"):null;if(r){let r=l();r.width=e.width,r.height=e.height;let i=f(r);if(null!=i){let r=e.height,n=e.width;if(void 0!==t&&void 0!==t.resizedHeight&&void 0!==t.resizedWidth&&(r=t.resizedHeight,n=t.resizedWidth),void 0!==t){if(u=t,void 0!==t.tensorFormat)throw Error("Image input config format must be RGBA for HTMLImageElement");u.tensorFormat="RGBA",u.height=r,u.width=n}else u.tensorFormat="RGBA",u.height=r,u.width=n;i.drawImage(e,0,0),s=i.getImageData(0,0,n,r).data}else throw Error("Can not access image data")}else if(i){let r,i;if(void 0!==t&&void 0!==t.resizedWidth&&void 0!==t.resizedHeight?(r=t.resizedHeight,i=t.resizedWidth):(r=e.height,i=e.width),void 0!==t&&(u=t),u.format="RGBA",u.height=r,u.width=i,void 0!==t){let t=l();t.width=i,t.height=r;let n=f(t);if(null!=n)n.putImageData(e,0,0),s=n.getImageData(0,0,i,r).data;else throw Error("Can not access image data")}else s=e.data}else if(n){if(void 0===t)throw Error("Please provide image config with format for Imagebitmap");let r=l();r.width=e.width,r.height=e.height;let i=f(r);if(null!=i){let t=e.height,r=e.width;return i.drawImage(e,0,0,r,t),s=i.getImageData(0,0,r,t).data,u.height=t,u.width=r,g(s,u)}throw Error("Can not access image data")}else{if(o)return new Promise((t,r)=>{let i=l(),n=f(i);if(!e||!n)return r();let o=new Image;o.crossOrigin="Anonymous",o.src=e,o.onload=()=>{i.width=o.width,i.height=o.height,n.drawImage(o,0,0,i.width,i.height);let e=n.getImageData(0,0,i.width,i.height);u.height=i.height,u.width=i.width,t(g(e.data,u))}});throw Error("Input data provided is not supported - aborted tensor creation")}if(void 0!==s)return g(s,u);throw Error("Input data provided is not supported - aborted tensor creation")},w=(e,t)=>{let{width:r,height:i,download:n,dispose:o}=t;return new S({location:"texture",type:"float32",texture:e,dims:[1,i,r,4],download:n,dispose:o})},v=(e,t)=>{let{dataType:r,dims:i,download:n,dispose:o}=t;return new S({location:"gpu-buffer",type:r??"float32",gpuBuffer:e,dims:i,download:n,dispose:o})},C=(e,t)=>{let{dataType:r,dims:i,download:n,dispose:o}=t;return new S({location:"ml-tensor",type:r??"float32",mlTensor:e,dims:i,download:n,dispose:o})},T=(e,t,r)=>new S({location:"cpu-pinned",type:e,data:t,dims:r??[t.length]})}),X=N(()=>{"use strict";_=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),E=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),x=!1,A=()=>{if(!x){x=!0;let e="u">typeof BigInt64Array&&BigInt64Array.from,t="u">typeof BigUint64Array&&BigUint64Array.from,r=globalThis.Float16Array,i="u">typeof r&&r.from;e&&(_.set("int64",BigInt64Array),E.set(BigInt64Array,"int64")),t&&(_.set("uint64",BigUint64Array),E.set(BigUint64Array,"uint64")),i?(_.set("float16",r),E.set(r,"float16")):_.set("float16",Uint16Array)}}}),Q=N(()=>{"use strict";K(),O=e=>{let t=1;for(let r=0;r<e.length;r++){let i=e[r];if("number"!=typeof i||!Number.isSafeInteger(i))throw TypeError(`dims[${r}] must be an integer, got: ${i}`);if(i<0)throw RangeError(`dims[${r}] must be a non-negative integer, got: ${i}`);t*=i}return t},I=(e,t)=>{switch(e.location){case"cpu":return new S(e.type,e.data,t);case"cpu-pinned":return new S({location:"cpu-pinned",data:e.data,type:e.type,dims:t});case"texture":return new S({location:"texture",texture:e.texture,type:e.type,dims:t});case"gpu-buffer":return new S({location:"gpu-buffer",gpuBuffer:e.gpuBuffer,type:e.type,dims:t});case"ml-tensor":return new S({location:"ml-tensor",mlTensor:e.mlTensor,type:e.type,dims:t});default:throw Error(`tensorReshape: tensor location ${e.location} is not supported`)}}}),K=N(()=>{"use strict";Y(),Z(),X(),Q(),S=class{constructor(e,t,r){let i,n;if(A(),"object"==typeof e&&"location"in e)switch(this.dataLocation=e.location,i=e.type,n=e.dims,e.location){case"cpu-pinned":{let t=_.get(i);if(!t)throw TypeError(`unsupported type "${i}" to create tensor from pinned buffer`);if(!(e.data instanceof t))throw TypeError(`buffer should be of type ${t.name}`);this.cpuData=e.data;break}case"texture":if("float32"!==i)throw TypeError(`unsupported type "${i}" to create tensor from texture`);this.gpuTextureData=e.texture,this.downloader=e.download,this.disposer=e.dispose;break;case"gpu-buffer":if("float32"!==i&&"float16"!==i&&"int32"!==i&&"int64"!==i&&"uint32"!==i&&"uint8"!==i&&"bool"!==i&&"uint4"!==i&&"int4"!==i)throw TypeError(`unsupported type "${i}" to create tensor from gpu buffer`);this.gpuBufferData=e.gpuBuffer,this.downloader=e.download,this.disposer=e.dispose;break;case"ml-tensor":if("float32"!==i&&"float16"!==i&&"int32"!==i&&"int64"!==i&&"uint32"!==i&&"uint64"!==i&&"int8"!==i&&"uint8"!==i&&"bool"!==i&&"uint4"!==i&&"int4"!==i)throw TypeError(`unsupported type "${i}" to create tensor from MLTensor`);this.mlTensorData=e.mlTensor,this.downloader=e.download,this.disposer=e.dispose;break;default:throw Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let o,s;if("string"==typeof e)if(i=e,s=r,"string"===e){if(!Array.isArray(t))throw TypeError("A string tensor's data must be a string array.");o=t}else{let r=_.get(e);if(void 0===r)throw TypeError(`Unsupported tensor type: ${e}.`);if(Array.isArray(t)){if("float16"===e&&r===Uint16Array||"uint4"===e||"int4"===e)throw TypeError(`Creating a ${e} tensor from number array is not supported. Please use ${r.name} as data.`);o="uint64"===e||"int64"===e?r.from(t,BigInt):r.from(t)}else if(t instanceof r)o=t;else if(t instanceof Uint8ClampedArray)if("uint8"===e)o=Uint8Array.from(t);else throw TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if("float16"===e&&t instanceof Uint16Array&&r!==Uint16Array)o=new globalThis.Float16Array(t.buffer,t.byteOffset,t.length);else throw TypeError(`A ${i} tensor's data must be type of ${r}`)}else if(s=t,Array.isArray(e)){if(0===e.length)throw TypeError("Tensor type cannot be inferred from an empty array.");let t=typeof e[0];if("string"===t)i="string",o=e;else if("boolean"===t)i="bool",o=Uint8Array.from(e);else throw TypeError(`Invalid element type of data array: ${t}.`)}else if(e instanceof Uint8ClampedArray)i="uint8",o=Uint8Array.from(e);else{let t=E.get(e.constructor);if(void 0===t)throw TypeError(`Unsupported type for tensor data: ${e.constructor}.`);i=t,o=e}if(void 0===s)s=[o.length];else if(!Array.isArray(s))throw TypeError("A tensor's dims must be a number array");n=s,this.cpuData=o,this.dataLocation="cpu"}let o=O(n);if(this.cpuData&&o!==this.cpuData.length&&("uint4"!==i&&"int4"!==i||Math.ceil(o/2)!==this.cpuData.length))throw Error(`Tensor's size(${o}) does not match data length(${this.cpuData.length}).`);this.type=i,this.dims=n,this.size=o}static async fromImage(e,t){return b(e,t)}static fromTexture(e,t){return w(e,t)}static fromGpuBuffer(e,t){return v(e,t)}static fromMLTensor(e,t){return C(e,t)}static fromPinnedBuffer(e,t,r){return T(e,t,r)}toDataURL(e){return y(this,e)}toImageData(e){return m(this,e)}get data(){if(this.ensureValid(),!this.cpuData)throw Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(e){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":if(!this.downloader)throw Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let t=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=t,e&&this.disposer&&(this.disposer(),this.disposer=void 0),t}finally{this.isDownloading=!1}default:throw Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if("none"===this.dataLocation)throw Error("The tensor is disposed.")}reshape(e){if(this.ensureValid(),this.downloader||this.disposer)throw Error("Cannot reshape a tensor that owns GPU resource.");return I(this,e)}}}),J=N(()=>{"use strict";K(),U=S}),ee=N(()=>{"use strict";H(),B=(e,t)=>{(typeof p.trace>"u"?p.wasm.trace:p.trace)&&console.timeStamp(`${e}::ORT::${t}`)},R=(e,t)=>{let r=Error().stack?.split(/\r\n|\r|\n/g)||[],i=!1;for(let n=0;n<r.length;n++){if(i&&!r[n].includes("TRACE_FUNC")){let i=`FUNC_${e}::${r[n].trim().split(" ")[1]}`;t&&(i+=`::${t}`),B("CPU",i);return}r[n].includes("TRACE_FUNC")&&(i=!0)}},M=e=>{(typeof p.trace>"u"?p.wasm.trace:p.trace)&&R("BEGIN",e)},j=e=>{(typeof p.trace>"u"?p.wasm.trace:p.trace)&&R("END",e)},L=e=>{(typeof p.trace>"u"?p.wasm.trace:p.trace)&&console.time(`ORT::${e}`)},P=e=>{(typeof p.trace>"u"?p.wasm.trace:p.trace)&&console.timeEnd(`ORT::${e}`)}}),et=N(()=>{"use strict";F(),J(),ee(),$=class e{constructor(e){this.handler=e}async run(e,t,r){M(),L("InferenceSession.run");let i={},n={};if("object"!=typeof e||null===e||e instanceof U||Array.isArray(e))throw TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let o=!0;if("object"==typeof t){if(null===t)throw TypeError("Unexpected argument[1]: cannot be null.");if(t instanceof U)throw TypeError("'fetches' cannot be a Tensor");if(Array.isArray(t)){if(0===t.length)throw TypeError("'fetches' cannot be an empty array.");for(let e of(o=!1,t)){if("string"!=typeof e)throw TypeError("'fetches' must be a string array or an object.");if(-1===this.outputNames.indexOf(e))throw RangeError(`'fetches' contains invalid output name: ${e}.`);i[e]=null}if("object"==typeof r&&null!==r)n=r;else if("u">typeof r)throw TypeError("'options' must be an object.")}else{let e=!1,s=Object.getOwnPropertyNames(t);for(let r of this.outputNames)if(-1!==s.indexOf(r)){let n=t[r];(null===n||n instanceof U)&&(e=!0,o=!1,i[r]=n)}if(e){if("object"==typeof r&&null!==r)n=r;else if("u">typeof r)throw TypeError("'options' must be an object.")}else n=t}}else if("u">typeof t)throw TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let t of this.inputNames)if(typeof e[t]>"u")throw Error(`input '${t}' is missing in 'feeds'.`);if(o)for(let e of this.outputNames)i[e]=null;let s=await this.handler.run(e,i,n),u={};for(let e in s)if(Object.hasOwnProperty.call(s,e)){let t=s[e];t instanceof U?u[e]=t:u[e]=new U(t.type,t.data,t.dims)}return P("InferenceSession.run"),j(),u}async release(){return this.handler.dispose()}static async create(t,r,i,n){M(),L("InferenceSession.create");let o,s={};if("string"==typeof t){if(o=t,"object"==typeof r&&null!==r)s=r;else if("u">typeof r)throw TypeError("'options' must be an object.")}else if(t instanceof Uint8Array){if(o=t,"object"==typeof r&&null!==r)s=r;else if("u">typeof r)throw TypeError("'options' must be an object.")}else if(t instanceof ArrayBuffer||"u">typeof SharedArrayBuffer&&t instanceof SharedArrayBuffer){let e=0,u=t.byteLength;if("object"==typeof r&&null!==r)s=r;else if("number"==typeof r){if(!Number.isSafeInteger(e=r))throw RangeError("'byteOffset' must be an integer.");if(e<0||e>=t.byteLength)throw RangeError(`'byteOffset' is out of range [0, ${t.byteLength}).`);if(u=t.byteLength-e,"number"==typeof i){if(!Number.isSafeInteger(u=i))throw RangeError("'byteLength' must be an integer.");if(u<=0||e+u>t.byteLength)throw RangeError(`'byteLength' is out of range (0, ${t.byteLength-e}].`);if("object"==typeof n&&null!==n)s=n;else if("u">typeof n)throw TypeError("'options' must be an object.")}else if("u">typeof i)throw TypeError("'byteLength' must be a number.")}else if("u">typeof r)throw TypeError("'options' must be an object.");o=new Uint8Array(t,e,u)}else throw TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[u,l]=await f(s),d=await u.createInferenceSessionHandler(o,l);return P("InferenceSession.create"),j(),new e(d)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),er=N(()=>{"use strict";et(),k=$}),ei=N(()=>{}),en=N(()=>{}),ea=N(()=>{}),eo=N(()=>{}),es={};W(es,{InferenceSession:()=>k,TRACE:()=>B,TRACE_EVENT_BEGIN:()=>L,TRACE_EVENT_END:()=>P,TRACE_FUNC_BEGIN:()=>M,TRACE_FUNC_END:()=>j,Tensor:()=>U,env:()=>h,registerBackend:()=>u});var eu=N(()=>{"use strict";V(),q(),er(),J(),ei(),en(),ee(),ea(),eo()}),el=N(()=>{}),ef={};W(ef,{default:()=>ec});var ed,ec,ep=N(()=>{"use strict";tQ(),to(),ta(),(ed=globalThis.self?.name==="ort-wasm-proxy-worker")&&(self.onmessage=e=>{let{type:t,in:r}=e.data;try{switch(t){case"init-wasm":eR(r.wasm).then(()=>{tb(r).then(()=>{postMessage({type:t})},e=>{postMessage({type:t,err:e})})},e=>{postMessage({type:t,err:e})});break;case"init-ep":{let{epName:e,env:i}=r;tw(i,e).then(()=>{postMessage({type:t})},e=>{postMessage({type:t,err:e})});break}case"copy-from":{let{buffer:e}=r,i=tT(e);postMessage({type:t,out:i});break}case"create":{let{model:e,options:i}=r;t_(e,i).then(e=>{postMessage({type:t,out:e})},e=>{postMessage({type:t,err:e})});break}case"release":tE(r),postMessage({type:t});break;case"run":{let{sessionId:e,inputIndices:i,inputs:n,outputIndices:o,options:s}=r;tA(e,i,n,o,Array(o.length).fill(null),s).then(e=>{e.some(e=>"cpu"!==e[3])?postMessage({type:t,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:t,out:e},tI([...n,...e]))},e=>{postMessage({type:t,err:e})});break}case"end-profiling":tO(r),postMessage({type:t})}}catch(e){postMessage({type:t,err:e})}}),ec=ed?null:e=>new Worker(e??ew,{type:"module",name:"ort-wasm-proxy-worker"})}),eh={};W(eh,{default:()=>em});var ey,em,eg,eb,ew,ev,eC,eT,e_,eE,ex,eA,eO,eI,eS,eU,eB,eR,eM,ej,eL,eP,e$,ek,eD,eN,eW,eG,eF,eV,ez,eH,eq,eY,eZ,eX,eQ,eK,eJ,e0,e1,e2,e3,e4,e6,e8,e5,e7,e9,te,tt,tr,ti,tn=N(()=>{"use strict";em=ey=async function(e={}){var t,r,i=new Promise((e,i)=>{t=e,r=i}),n="object"==typeof window,o="u">typeof WorkerGlobalScope,s=o&&self.name?.startsWith("em-pthread");e.mountExternalData=(t,r)=>{t.startsWith("./")&&(t=t.substring(2)),(e.fc||(e.fc=new Map)).set(t,r)},e.unmountExternalData=()=>{delete e.fc};var u=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,ld:!0}).buffer.constructor;let l=()=>{let t=(e,t,r)=>(...i)=>{let n=tA,o=t?.();i=e(...i);let s=t?.();return o!==s&&(e=s,r(o),t=r=null),tA!=n?new Promise((e,t)=>{tR={resolve:e,reject:t}}):i};(()=>{for(let r of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])e[r]=t(e[r],()=>e[r],t=>e[r]=t)})(),"u">typeof jsepRunAsync&&(e._OrtRun=jsepRunAsync(e._OrtRun),e._OrtRunWithBinding=jsepRunAsync(e._OrtRunWithBinding)),l=void 0};e.asyncInit=()=>{l?.()};var f,d,c=(e,t)=>{throw t},p=import.meta.url,h="";if(n||o){try{h=new URL(".",p).href}catch{}o&&(d=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),f=async e=>{if(L(e))return new Promise((t,r)=>{var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=()=>{200==i.status||0==i.status&&i.response?t(i.response):r(i.status)},i.onerror=r,i.send(null)});var t=await fetch(e,{credentials:"same-origin"});if(t.ok)return t.arrayBuffer();throw Error(t.status+" : "+t.url)}}var y,m,g,b,w,v,C,T,_,E,x,A,O,I,S,U=console.log.bind(console),B=console.error.bind(console),R=U,M=B,j=!1,L=e=>e.startsWith("file://");function P(){return m.buffer!=w.buffer&&z(),w}function $(){return m.buffer!=w.buffer&&z(),v}function k(){return m.buffer!=w.buffer&&z(),C}function D(){return m.buffer!=w.buffer&&z(),T}function N(){return m.buffer!=w.buffer&&z(),_}function W(){return m.buffer!=w.buffer&&z(),E}function G(){return m.buffer!=w.buffer&&z(),x}function F(){return m.buffer!=w.buffer&&z(),I}if(s){let t=function(r){try{var i=r.data,n=i.dc;if("load"===n){let r=[];for(let n of(self.onmessage=e=>r.push(e),self.startWorker=()=>{for(let e of(postMessage({dc:"loaded"}),r))t(e);self.onmessage=t},i.Uc))e[n]&&!e[n].proxy||(e[n]=(...e)=>{postMessage({dc:"callHandler",Tc:n,args:e})},"print"==n&&(R=e[n]),"printErr"==n&&(M=e[n]));m=i.bd,z(),S(i.cd)}else if("run"===n){em(i.ac),i3(i.ac,0,0,1,0,0),ep(),tc(i.ac),V||(ij(),V=!0);try{eg(i.Zc,i.jc)}catch(e){if("unwind"!=e)throw e}}else"setimmediate"!==i.target&&("checkMailbox"===n?V&&tp():n&&(M(`worker: received unknown command ${n}`),M(i)))}catch(e){throw i4(),e}};var V=!1;self.onunhandledrejection=e=>{throw e.reason||e},self.onmessage=t}function z(){var t=m.buffer;e.HEAP8=w=new Int8Array(t),C=new Int16Array(t),e.HEAPU8=v=new Uint8Array(t),T=new Uint16Array(t),e.HEAP32=_=new Int32Array(t),e.HEAPU32=E=new Uint32Array(t),x=new Float32Array(t),I=new Float64Array(t),A=new BigInt64Array(t),O=new BigUint64Array(t)}function H(){s?startWorker(e):iR.nb()}var q,Y=0,Z=null;function X(){if(0==--Y&&Z){var e=Z;Z=null,e()}}function Q(e){throw M(e="Aborted("+e+")"),j=!0,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),r(e),e}function K(){return{a:{R:iB,b:ev,ba:eT,I:eA,ra:eO,jb:eI,lb:eS,sa:eU,pa:eB,ia:eR,oa:eM,P:ej,kb:eL,hb:eP,qa:e$,ib:ek,xa:eN,Z:eY,cb:eX,ab:e4,Y:e6,w:e8,t:e5,bb:te,L:tu,db:tl,la:tf,fb:th,ca:tm,_a:tg,$:tb,ka:tc,ua:tw,s:tT,Na:t_,A:tL,o:t$,m:tN,c:eJ,Ma:tW,n:tF,i:tV,v:tz,p:tH,f:tq,u:tY,k:tZ,e:tX,j:tQ,h:tK,g:tJ,d:t0,fa:t1,ga:t6,ha:t8,da:t5,ea:t7,$a:rt,za:rr,wa:rn,E:rs,La:ru,M:rl,va:ri,C:rf,ta:rd,gb:rc,r:re,Ia:rp,F:rh,Q:ry,eb:rm,Ba:rv,Aa:rC,Ha:rN,q:rW,U:rF,T:rV,Ka:rz,D:rH,l:rq,Ga:rY,Fa:rZ,Ja:rX,Ea:rQ,Da:rK,Ca:rJ,ma:r3,na:r4,aa:es,J:r6,O:r8,ja:r5,N:r9,a:m,ya:ea,Xa:ie,K:it,x:ir,S:ii,Ya:ia,y:io,Ta:is,Va:iu,V:il,z:id,_:ic,W:ip,G:ih,Ra:iy,mb:im,B:ig,Ua:ib,Wa:iw,Oa:iv,Pa:iC,Qa:iT,H:i_,X:iE,Sa:ix,Za:iA}}}class J{name="ExitStatus";constructor(e){this.message=`Program terminated with exit(${e})`,this.status=e}}var ee=e=>{e.terminate(),e.onmessage=()=>{}},et=[],er=e=>{0==eu.length&&(ey(),eh(eu[0]));var t=eu.pop();if(!t)return 6;el.push(t),ed[e.ac]=t,t.ac=e.ac;var r={dc:"run",Zc:e.Yc,jc:e.jc,ac:e.ac};return t.postMessage(r,e.Oc),0},ei=0,en=(e,t,...r)=>{for(var i=2*r.length,n=nn(),o=ni(8*i),s=o>>>3,u=0;u<r.length;u++){var l=r[u];"bigint"==typeof l?(A[s+2*u]=1n,A[s+2*u+1]=l):(A[s+2*u]=0n,F()[s+2*u+1>>>0]=l)}return e=i6(e,0,i,o,t),nr(n),e};function ea(e){if(s)return en(0,1,e);if(b=e,!(0<ei)){for(var t of el)ee(t);for(t of eu)ee(t);eu=[],el=[],ed={},j=!0}c(0,new J(e))}function eo(e){if(s)return en(1,0,e);es(e)}var es=e=>{if(b=e,s)throw eo(e),"unwind";ea(e)},eu=[],el=[],ef=[],ed={},ec=e=>{var t=e.ac;delete ed[t],eu.push(e),el.splice(el.indexOf(e),1),e.ac=0,i8(t)};function ep(){ef.forEach(e=>e())}var eh=t=>new Promise(r=>{t.onmessage=i=>{var n=(i=i.data).dc;if(i.hc&&i.hc!=iP()){var o=ed[i.hc];o?o.postMessage(i,i.Oc):M(`Internal error! Worker sent a message "${n}" to target pthread ${i.hc}, but that thread no longer exists!`)}else"checkMailbox"===n?tp():"spawnThread"===n?er(i):"cleanupThread"===n?ec(ed[i.$c]):"loaded"===n?(t.loaded=!0,r(t)):"setimmediate"===i.target?t.postMessage(i):"callHandler"===n?e[i.Tc](...i.args):n&&M(`worker sent an unknown command ${n}`)},t.onerror=e=>{throw M(`worker sent an error! ${e.filename}:${e.lineno}: ${e.message}`),e};var i,n=[];for(i of[])e.propertyIsEnumerable(i)&&n.push(i);t.postMessage({dc:"load",Uc:n,bd:m,cd:g})});function ey(){let e;var t=new Worker((e=URL,import.meta.url>"file:"&&import.meta.url<"file;"?new e("ort.webgpu.bundle.min.mjs",import.meta.url):new URL(import.meta.url)),{type:"module",workerData:"em-pthread",name:"em-pthread"});eu.push(t)}var em=e=>{z();var t=W()[e+52>>>2>>>0];e=W()[e+56>>>2>>>0],nt(t,t-e),nr(t)},eg=(e,t)=>{ei=0,e=na(e,t),0<ei?b=e:i5(e)};class eb{constructor(e){this.ic=e-24}}var ew=e=>-0x20000000000000>e||0x20000000000000<e?NaN:Number(e);function ev(e,t,r){var i=new eb(e>>>=0);throw t>>>=0,r>>>=0,W()[i.ic+16>>>2>>>0]=0,W()[i.ic+4>>>2>>>0]=t,W()[i.ic+8>>>2>>>0]=r,e}function eC(e,t,r,i){return s?en(2,1,e,t,r,i):eT(e,t,r,i)}function eT(e,t,r,i){if(e>>>=0,r>>>=0,i>>>=0,void 0===u)return 6;var n=[];return s&&0===n.length?eC(e,t>>>=0,r,i):(e={Yc:r,ac:e,jc:i,Oc:n},s?(e.dc="spawnThread",postMessage(e,n),0):er(e))}var e_="u">typeof TextDecoder?new TextDecoder:void 0,eE=(e,t=0,r=NaN)=>{var i=(t>>>=0)+r;for(r=t;e[r]&&!(r>=i);)++r;if(16<r-t&&e.buffer&&e_)return e_.decode(e.buffer instanceof ArrayBuffer?e.subarray(t,r):e.slice(t,r));for(i="";t<r;){var n=e[t++];if(128&n){var o=63&e[t++];if((224&n)==192)i+=String.fromCharCode((31&n)<<6|o);else{var s=63&e[t++];65536>(n=(240&n)==224?(15&n)<<12|o<<6|s:(7&n)<<18|o<<12|s<<6|63&e[t++])?i+=String.fromCharCode(n):(n-=65536,i+=String.fromCharCode(55296|n>>10,56320|1023&n))}}else i+=String.fromCharCode(n)}return i},ex=(e,t)=>(e>>>=0)?eE($(),e,t):"";function eA(e,t,r){return s?en(3,1,e,t,r):0}function eO(e,t){if(s)return en(4,1,e,t)}function eI(e,t){if(s)return en(5,1,e,t)}function eS(e,t,r){if(s)return en(6,1,e,t,r)}function eU(e,t,r){return s?en(7,1,e,t,r):0}function eB(e,t){if(s)return en(8,1,e,t)}function eR(e,t,r){if(s)return en(9,1,e,t,r)}function eM(e,t,r,i){if(s)return en(10,1,e,t,r,i)}function ej(e,t,r,i){if(s)return en(11,1,e,t,r,i)}function eL(e,t,r,i){if(s)return en(12,1,e,t,r,i)}function eP(e){if(s)return en(13,1,e)}function e$(e,t){if(s)return en(14,1,e,t)}function ek(e,t,r){if(s)return en(15,1,e,t,r)}var eD,eN=()=>Q(""),eW=e=>{for(var t="";$()[e>>>0];)t+=eD[$()[e++>>>0]];return t},eG={},eF={},eV={},ez=e.BindingError=class extends Error{constructor(e){super(e),this.name="BindingError"}};function eH(e,t,r={}){return function(e,t,r={}){var i=t.name;if(!e)throw new ez(`type "${i}" must have a positive integer typeid pointer`);if(eF.hasOwnProperty(e)){if(r.Vc)return;throw new ez(`Cannot register type '${i}' twice`)}eF[e]=t,delete eV[e],eG.hasOwnProperty(e)&&(t=eG[e],delete eG[e],t.forEach(e=>e()))}(e,t,r)}var eq=(e,t,r)=>{switch(t){case 1:return r?e=>P()[e>>>0]:e=>$()[e>>>0];case 2:return r?e=>k()[e>>>1>>>0]:e=>D()[e>>>1>>>0];case 4:return r?e=>N()[e>>>2>>>0]:e=>W()[e>>>2>>>0];case 8:return r?e=>A[e>>>3]:e=>O[e>>>3];default:throw TypeError(`invalid integer width (${t}): ${e}`)}};function eY(e,t,r){r>>>=0,eH(e>>>=0,{name:t=eW(t>>>0),fromWireType:e=>e,toWireType:function(e,t){if("bigint"!=typeof t&&"number"!=typeof t)throw t=null===t?"null":"object"==(e=typeof t)||"array"===e||"function"===e?t.toString():""+t,TypeError(`Cannot convert "${t}" to ${this.name}`);return"number"==typeof t&&(t=BigInt(t)),t},cc:eZ,readValueFromPointer:eq(t,r,-1==t.indexOf("u")),ec:null})}var eZ=8;function eX(e,t,r,i){eH(e>>>=0,{name:t=eW(t>>>0),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?r:i},cc:eZ,readValueFromPointer:function(e){return this.fromWireType($()[e>>>0])},ec:null})}var eQ=[],eK=[];function eJ(e){9<(e>>>=0)&&0==--eK[e+1]&&(eK[e]=void 0,eQ.push(e))}var e0=e=>{if(!e)throw new ez(`Cannot use deleted val. handle = ${e}`);return eK[e]},e1=e=>{switch(e){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let t=eQ.pop()||eK.length;return eK[t]=e,eK[t+1]=1,t}};function e2(e){return this.fromWireType(W()[e>>>2>>>0])}var e3={name:"emscripten::val",fromWireType:e=>{var t=e0(e);return eJ(e),t},toWireType:(e,t)=>e1(t),cc:8,readValueFromPointer:e2,ec:null};function e4(e){return eH(e>>>0,e3)}function e6(e,t,r){r>>>=0,eH(e>>>=0,{name:t=eW(t>>>0),fromWireType:e=>e,toWireType:(e,t)=>t,cc:eZ,readValueFromPointer:((e,t)=>{switch(t){case 4:return function(e){return this.fromWireType(G()[e>>>2>>>0])};case 8:return function(e){return this.fromWireType(F()[e>>>3>>>0])};default:throw TypeError(`invalid float width (${t}): ${e}`)}})(t,r),ec:null})}function e8(e,t,r,i,n){if(e>>>=0,r>>>=0,t=eW(t>>>0),-1===n&&(n=0xffffffff),n=e=>e,0===i){var o=32-8*r;n=e=>e<<o>>>o}var s=t.includes("unsigned")?function(e,t){return t>>>0}:function(e,t){return t};eH(e,{name:t,fromWireType:n,toWireType:s,cc:eZ,readValueFromPointer:eq(t,r,0!==i),ec:null})}function e5(e,t,r){function i(e){var t=W()[e>>>2>>>0];return e=W()[e+4>>>2>>>0],new n(P().buffer,e,t)}var n=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][t];eH(e>>>=0,{name:r=eW(r>>>0),fromWireType:i,cc:eZ,readValueFromPointer:i},{Vc:!0})}var e7=(e,t,r)=>{var i=$();if(t>>>=0,0<r){var n=t;r=t+r-1;for(var o=0;o<e.length;++o){var s=e.charCodeAt(o);if(55296<=s&&57343>=s&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o)),127>=s){if(t>=r)break;i[t++>>>0]=s}else{if(2047>=s){if(t+1>=r)break;i[t++>>>0]=192|s>>6}else{if(65535>=s){if(t+2>=r)break;i[t++>>>0]=224|s>>12}else{if(t+3>=r)break;i[t++>>>0]=240|s>>18,i[t++>>>0]=128|s>>12&63}i[t++>>>0]=128|s>>6&63}i[t++>>>0]=128|63&s}}i[t>>>0]=0,e=t-n}else e=0;return e},e9=e=>{for(var t=0,r=0;r<e.length;++r){var i=e.charCodeAt(r);127>=i?t++:2047>=i?t+=2:55296<=i&&57343>=i?(t+=4,++r):t+=3}return t};function te(e,t){eH(e>>>=0,{name:t=eW(t>>>0),fromWireType:function(e){for(var t,r=W()[e>>>2>>>0],i=e+4,n=i,o=0;o<=r;++o){var s=i+o;o!=r&&0!=$()[s>>>0]||(n=ex(n,s-n),void 0===t?t=n:(t+="\0",t+=n),n=s+1)}return i$(e),t},toWireType:function(e,t){t instanceof ArrayBuffer&&(t=new Uint8Array(t));var r="string"==typeof t;if(!(r||ArrayBuffer.isView(t)&&1==t.BYTES_PER_ELEMENT))throw new ez("Cannot pass non-string to std::string");var i=r?e9(t):t.length,n=ik(4+i+1),o=n+4;return W()[n>>>2>>>0]=i,r?e7(t,o,i+1):$().set(t,o>>>0),null!==e&&e.push(i$,n),n},cc:eZ,readValueFromPointer:e2,ec(e){i$(e)}})}var tt="u">typeof TextDecoder?new TextDecoder("utf-16le"):void 0,tr=(e,t)=>{for(var r=e>>1,i=r+t/2;!(r>=i)&&D()[r>>>0];)++r;if(32<(r<<=1)-e&&tt)return tt.decode($().slice(e,r));for(r="",i=0;!(i>=t/2);++i){var n=k()[e+2*i>>>1>>>0];if(0==n)break;r+=String.fromCharCode(n)}return r},ti=(e,t,r)=>{if(2>(r??=0x7fffffff))return 0;var i=t;r=(r-=2)<2*e.length?r/2:e.length;for(var n=0;n<r;++n){var o=e.charCodeAt(n);k()[t>>>1>>>0]=o,t+=2}return k()[t>>>1>>>0]=0,t-i},tn=e=>2*e.length,ta=(e,t)=>{for(var r=0,i="";!(r>=t/4);){var n=N()[e+4*r>>>2>>>0];if(0==n)break;++r,65536<=n?(n-=65536,i+=String.fromCharCode(55296|n>>10,56320|1023&n)):i+=String.fromCharCode(n)}return i},to=(e,t,r)=>{if(t>>>=0,4>(r??=0x7fffffff))return 0;var i=t;r=i+r-4;for(var n=0;n<e.length;++n){var o=e.charCodeAt(n);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&e.charCodeAt(++n)),N()[t>>>2>>>0]=o,(t+=4)+4>r)break}return N()[t>>>2>>>0]=0,t-i},ts=e=>{for(var t=0,r=0;r<e.length;++r){var i=e.charCodeAt(r);55296<=i&&57343>=i&&++r,t+=4}return t};function tu(e,t,r){if(e>>>=0,t>>>=0,r=eW(r>>>=0),2===t)var i=tr,n=ti,o=tn,s=e=>D()[e>>>1>>>0];else 4===t&&(i=ta,n=to,o=ts,s=e=>W()[e>>>2>>>0]);eH(e,{name:r,fromWireType:e=>{for(var r,n=W()[e>>>2>>>0],o=e+4,u=0;u<=n;++u){var l=e+4+u*t;u!=n&&0!=s(l)||(o=i(o,l-o),void 0===r?r=o:(r+="\0",r+=o),o=l+t)}return i$(e),r},toWireType:(e,i)=>{if("string"!=typeof i)throw new ez(`Cannot pass non-string to C++ string type ${r}`);var s=o(i),u=ik(4+s+t);return W()[u>>>2>>>0]=s/t,n(i,u+4,s+t),null!==e&&e.push(i$,u),u},cc:eZ,readValueFromPointer:e2,ec(e){i$(e)}})}function tl(e,t){eH(e>>>=0,{Wc:!0,name:t=eW(t>>>0),cc:0,fromWireType:()=>{},toWireType:()=>{}})}function tf(e){i3(e>>>0,!o,1,!n,131072,!1),ep()}var td=e=>{if(!j)try{if(e(),!(0<ei))try{s?i5(b):es(b)}catch(e){e instanceof J||"unwind"==e||c(0,e)}}catch(e){e instanceof J||"unwind"==e||c(0,e)}};function tc(e){e>>>=0,"function"==typeof Atomics.ad&&(Atomics.ad(N(),e>>>2,e).value.then(tp),e+=128,Atomics.store(N(),e>>>2,1))}var tp=()=>{var e=iP();e&&(tc(e),td(i9))};function th(e,t){(e>>>=0)==t>>>0?setTimeout(tp):s?postMessage({hc:e,dc:"checkMailbox"}):(e=ed[e])&&e.postMessage({dc:"checkMailbox"})}var ty=[];function tm(e,t,r,i,n){for(t>>>=0,ty.length=i/=2,r=n>>>0>>>3,n=0;n<i;n++)ty[n]=A[r+2*n]?A[r+2*n+1]:F()[r+2*n+1>>>0];return(t?iU[t]:iS[e])(...ty)}var tg=()=>{ei=0};function tb(e){e>>>=0,s?postMessage({dc:"cleanupThread",$c:e}):ec(ed[e])}function tw(e){}var tv=(e,t)=>{var r=eF[e];if(void 0===r)throw r=eW(e=iM(e)),i$(e),new ez(`${t} has unknown type ${r}`);return r},tC=(e,t,r)=>{var i=[];return e=e.toWireType(i,r),i.length&&(W()[t>>>2>>>0]=e1(i)),e};function tT(e,t,r){return t>>>=0,r>>>=0,e=e0(e>>>0),tC(t=tv(t,"emval::as"),r,e)}function t_(e,t){return t>>>=0,e=e0(e>>>0),(t=tv(t,"emval::as")).toWireType(null,e)}var tE=e=>{try{e()}catch(e){Q(e)}},tx=0,tA=null,tO=0,tI=[],tS={},tU={},tB=0,tR=null,tM=[];function tj(e){return function(e){if(!j){if(0===tx){var t,r,i,n=!1,o=!1;e((e=0)=>{if(!j&&(tO=e,n=!0,o)){tx=2,tE(()=>nu(tA)),"u">typeof MainLoop&&MainLoop.Sc&&MainLoop.resume(),e=!1;try{var t,r=(t=iR[tU[t=N()[tA+8>>>2>>>0]]],--ei,t())}catch(t){r=t,e=!0}var i=!1;if(!tA){var s=tR;s&&(tR=null,(e?s.reject:s.resolve)(r),i=!0)}if(e&&!i)throw r}}),o=!0,n||(tx=1,r=(t=ik(65548))+12,W()[t>>>2>>>0]=r,W()[t+4>>>2>>>0]=r+65536,void 0===(i=tS[r=tI[0]])&&(i=tB++,tS[r]=i,tU[i]=r),r=i,N()[t+8>>>2>>>0]=r,tA=t,"u">typeof MainLoop&&MainLoop.Sc&&MainLoop.pause(),tE(()=>no(tA)))}else 2===tx?(tx=0,tE(nl),i$(tA),tA=null,tM.forEach(td)):Q(`invalid state: ${tx}`);return tO}}(t=>{e().then(t)})}function tL(e){return e>>>=0,tj(async()=>e1(await e0(e)))}var tP=[];function t$(e,t,r,i){return r>>>=0,i>>>=0,(e=tP[e>>>0])(null,t=e0(t>>>0),r,i)}var tk={},tD=e=>{var t=tk[e];return void 0===t?eW(e):t};function tN(e,t,r,i,n){return r>>>=0,i>>>=0,n>>>=0,(e=tP[e>>>0])(t=e0(t>>>0),t[r=tD(r)],i,n)}function tW(e,t){return t>>>=0,(e=e0(e>>>0))==e0(t)}var tG=()=>"object"==typeof globalThis?globalThis:Function("return this")();function tF(e){return 0==(e>>>=0)?e1(tG()):(e=tD(e),e1(tG()[e]))}function tV(e,t,r){var i,n,o=(t=((e,t)=>{for(var r=Array(e),i=0;i<e;++i)r[i]=tv(W()[t+4*i>>>2>>>0],`parameter ${i}`);return r})(e,t>>>0)).shift();e--;var s=`return function (obj, func, destructorsRef, args) {
`,u=0,l=[];0===r&&l.push("obj");for(var f=["retType"],d=[o],c=0;c<e;++c)l.push(`arg${c}`),f.push(`argType${c}`),d.push(t[c]),s+=`  var arg${c} = argType${c}.readValueFromPointer(args${u?"+"+u:""});
`,u+=t[c].cc;return s+=`  var rv = ${1===r?"new func":"func.call"}(${l.join(", ")});
`,o.Wc||(f.push("emval_returnValue"),d.push(tC),s+=`  return emval_returnValue(retType, destructorsRef, rv);
`),i=Object.defineProperty(e=Function(...f,s+`};
`)(...d),"name",{value:r=`methodCaller<(${t.map(e=>e.name).join(", ")}) => ${o.name}>`}),n=tP.length,tP.push(i),n}function tz(t){return e1(e[t=tD(t>>>0)])}function tH(e,t){return t>>>=0,e1((e=e0(e>>>0))[t=e0(t)])}function tq(e){9<(e>>>=0)&&(eK[e+1]+=1)}function tY(){return e1([])}function tZ(e){e=e0(e>>>0);for(var t=Array(e.length),r=0;r<e.length;r++)t[r]=e[r];return e1(t)}function tX(e){return e1(tD(e>>>0))}function tQ(){return e1({})}function tK(e){for(var t=e0(e>>>=0);t.length;){var r=t.pop();t.pop()(r)}eJ(e)}function tJ(e,t,r){t>>>=0,r>>>=0,e=e0(e>>>0),t=e0(t),r=e0(r),e[t]=r}function t0(e,t){return t>>>=0,e1(e=(e=tv(e>>>0,"_emval_take_value")).readValueFromPointer(t))}function t1(e,t){e=ew(e),t>>>=0,e=new Date(1e3*e),N()[t>>>2>>>0]=e.getUTCSeconds(),N()[t+4>>>2>>>0]=e.getUTCMinutes(),N()[t+8>>>2>>>0]=e.getUTCHours(),N()[t+12>>>2>>>0]=e.getUTCDate(),N()[t+16>>>2>>>0]=e.getUTCMonth(),N()[t+20>>>2>>>0]=e.getUTCFullYear()-1900,N()[t+24>>>2>>>0]=e.getUTCDay(),e=(e.getTime()-Date.UTC(e.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,N()[t+28>>>2>>>0]=e}var t2=e=>e%4==0&&(e%100!=0||e%400==0),t3=[0,31,60,91,121,152,182,213,244,274,305,335],t4=[0,31,59,90,120,151,181,212,243,273,304,334];function t6(e,t){e=ew(e),t>>>=0,e=new Date(1e3*e),N()[t>>>2>>>0]=e.getSeconds(),N()[t+4>>>2>>>0]=e.getMinutes(),N()[t+8>>>2>>>0]=e.getHours(),N()[t+12>>>2>>>0]=e.getDate(),N()[t+16>>>2>>>0]=e.getMonth(),N()[t+20>>>2>>>0]=e.getFullYear()-1900,N()[t+24>>>2>>>0]=e.getDay();var r=(t2(e.getFullYear())?t3:t4)[e.getMonth()]+e.getDate()-1|0;N()[t+28>>>2>>>0]=r,N()[t+36>>>2>>>0]=-60*e.getTimezoneOffset(),r=new Date(e.getFullYear(),6,1).getTimezoneOffset();var i=new Date(e.getFullYear(),0,1).getTimezoneOffset();e=0|(r!=i&&e.getTimezoneOffset()==Math.min(i,r)),N()[t+32>>>2>>>0]=e}function t8(e){e>>>=0;var t=new Date(N()[e+20>>>2>>>0]+1900,N()[e+16>>>2>>>0],N()[e+12>>>2>>>0],N()[e+8>>>2>>>0],N()[e+4>>>2>>>0],N()[e>>>2>>>0],0),r=N()[e+32>>>2>>>0],i=t.getTimezoneOffset(),n=new Date(t.getFullYear(),6,1).getTimezoneOffset(),o=new Date(t.getFullYear(),0,1).getTimezoneOffset(),s=Math.min(o,n);return 0>r?N()[e+32>>>2>>>0]=+(n!=o&&s==i):0<r!=(s==i)&&(n=Math.max(o,n),t.setTime(t.getTime()+6e4*((0<r?s:n)-i))),N()[e+24>>>2>>>0]=t.getDay(),r=(t2(t.getFullYear())?t3:t4)[t.getMonth()]+t.getDate()-1|0,N()[e+28>>>2>>>0]=r,N()[e>>>2>>>0]=t.getSeconds(),N()[e+4>>>2>>>0]=t.getMinutes(),N()[e+8>>>2>>>0]=t.getHours(),N()[e+12>>>2>>>0]=t.getDate(),N()[e+16>>>2>>>0]=t.getMonth(),N()[e+20>>>2>>>0]=t.getYear(),BigInt(isNaN(e=t.getTime())?-1:e/1e3)}function t5(e,t,r,i,n,o,u){return s?en(16,1,e,t,r,i,n,o,u):-52}function t7(e,t,r,i,n,o){if(s)return en(17,1,e,t,r,i,n,o)}var t9={},re=()=>performance.timeOrigin+performance.now();function rt(e,t){if(s)return en(18,1,e,t);if(t9[e]&&(clearTimeout(t9[e].id),delete t9[e]),!t)return 0;var r=setTimeout(()=>{delete t9[e],td(()=>i7(e,performance.timeOrigin+performance.now()))},t);return t9[e]={id:r,nd:t},0}function rr(e,t,r,i){e>>>=0,t>>>=0,r>>>=0,i>>>=0;var n=new Date().getFullYear(),o=new Date(n,0,1).getTimezoneOffset(),s=Math.max(o,n=new Date(n,6,1).getTimezoneOffset());W()[e>>>2>>>0]=60*s,N()[t>>>2>>>0]=+(o!=n),e=(t=e=>{var t=Math.abs(e);return`UTC${0<=e?"-":"+"}${String(Math.floor(t/60)).padStart(2,"0")}${String(t%60).padStart(2,"0")}`})(o),t=t(n),n<o?(e7(e,r,17),e7(t,i,17)):(e7(e,i,17),e7(t,r,17))}var ri=()=>Date.now();function rn(e,t,r){return 0<=e&&3>=e?(e=0===e?Date.now():performance.timeOrigin+performance.now(),A[r>>>0>>>3]=BigInt(Math.round(1e6*e)),0):28}var ra=[],ro=(e,t)=>{ra.length=0;for(var r;r=$()[e++>>>0];){var i=105!=r;t+=(i&=112!=r)&&t%8?4:0,ra.push(112==r?W()[t>>>2>>>0]:106==r?A[t>>>3]:105==r?N()[t>>>2>>>0]:F()[t>>>3>>>0]),t+=i?8:4}return ra};function rs(e,t,r){return e>>>=0,t=ro(t>>>0,r>>>0),iU[e](...t)}function ru(e,t,r){return e>>>=0,t=ro(t>>>0,r>>>0),iU[e](...t)}var rl=()=>{};function rf(e,t){return M(ex(e>>>0,t>>>0))}var rd=()=>{throw ei+=1,"unwind"};function rc(){return 0xffff0000}var rp=()=>1,rh=()=>navigator.hardwareConcurrency;function ry(){return Q("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function rm(e){e>>>=0;var t=$().length;if(e<=t||0xffff0000<e)return!1;for(var r=1;4>=r;r*=2){var i=t*(1+.2/r);i=Math.min(i,e+0x6000000);e:{i=(Math.min(0xffff0000,65536*Math.ceil(Math.max(e,i)/65536))-m.buffer.byteLength+65535)/65536|0;try{m.grow(i),z();var n=1;break e}catch{}n=void 0}if(n)return!0}return!1}var rg=()=>(Q("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),rb={},rw=e=>{e.forEach(e=>{var t=rg();t&&(rb[t]=e)})};function rv(){var e=Error().stack.toString().split(`
`);return"Error"==e[0]&&e.shift(),rw(e),rb.oc=rg(),rb.Xc=e,rb.oc}function rC(e,t,r){if(e>>>=0,t>>>=0,rb.oc==e)var i=rb.Xc;else"Error"==(i=Error().stack.toString().split(`
`))[0]&&i.shift(),rw(i);for(var n=3;i[n]&&rg()!=e;)++n;for(e=0;e<r&&i[e+n];++e)N()[t+4*e>>>2>>>0]=rg();return e}var rT=e=>{var t=e9(e)+1,r=ni(t);return e7(e,r,t),r},r_=[],rE=(e,t)=>{r_[e>>>=0]=t},rx=[],rA=[],rO=(e,t)=>{rA[e]=new Promise(r=>t.finally(()=>r(e)))},rI=e=>{if(e)return r_[e>>>0]},rS=(e,t,r)=>{W()[e>>>2>>>0]=t,W()[e+4>>>2>>>0]=r},rU=e=>ex(W()[e>>>2>>>0],e=W()[e+4>>>2>>>0]),rB=e=>{var t=W()[e>>>2>>>0];return e=W()[e+4>>>2>>>0],t?ex(t,e):0===e?"":void 0},rR=(e,t)=>{function r(r,i){r=e[r],N()[t+i>>>2>>>0]=r}function i(r,i){A[t+i>>>3]=BigInt(e[r])}r("maxTextureDimension1D",4),r("maxTextureDimension2D",8),r("maxTextureDimension3D",12),r("maxTextureArrayLayers",16),r("maxBindGroups",20),r("maxBindGroupsPlusVertexBuffers",24),r("maxBindingsPerBindGroup",28),r("maxDynamicUniformBuffersPerPipelineLayout",32),r("maxDynamicStorageBuffersPerPipelineLayout",36),r("maxSampledTexturesPerShaderStage",40),r("maxSamplersPerShaderStage",44),r("maxStorageBuffersPerShaderStage",48),r("maxStorageTexturesPerShaderStage",52),r("maxUniformBuffersPerShaderStage",56),r("minUniformBufferOffsetAlignment",80),r("minStorageBufferOffsetAlignment",84),i("maxUniformBufferBindingSize",64),i("maxStorageBufferBindingSize",72),r("maxVertexBuffers",88),i("maxBufferSize",96),r("maxVertexAttributes",104),r("maxVertexBufferArrayStride",108),r("maxInterStageShaderVariables",112),r("maxColorAttachments",116),r("maxColorAttachmentBytesPerSample",120),r("maxComputeWorkgroupStorageSize",124),r("maxComputeInvocationsPerWorkgroup",128),r("maxComputeWorkgroupSizeX",132),r("maxComputeWorkgroupSizeY",136),r("maxComputeWorkgroupSizeZ",140),r("maxComputeWorkgroupsPerDimension",144),void 0!==e.kd&&r("maxImmediateSize",148)},rM={undefined:1,pd:1,gd:2},rj={1:"validation",2:"out-of-memory",3:"internal"},rL=[,"compatibility","core"],rP={1:"depth-clip-control",2:"depth32float-stencil8",3:"timestamp-query",4:"texture-compression-bc",5:"texture-compression-bc-sliced-3d",6:"texture-compression-etc2",7:"texture-compression-astc",8:"texture-compression-astc-sliced-3d",9:"indirect-first-instance",10:"shader-f16",11:"rg11b10ufloat-renderable",12:"bgra8unorm-storage",13:"float32-filterable",14:"float32-blendable",15:"clip-distances",16:"dual-source-blending",17:"subgroups",18:"core-features-and-limits",327692:"chromium-experimental-unorm16-texture-formats",327693:"chromium-experimental-snorm16-texture-formats",327732:"chromium-experimental-multi-draw-indirect"},r$=[,"low-power","high-performance"],rk={1:"occlusion",2:"timestamp"},rD={"depth-clip-control":"1","depth32float-stencil8":"2","timestamp-query":"3","texture-compression-bc":"4","texture-compression-bc-sliced-3d":"5","texture-compression-etc2":"6","texture-compression-astc":"7","texture-compression-astc-sliced-3d":"8","indirect-first-instance":"9","shader-f16":"10","rg11b10ufloat-renderable":"11","bgra8unorm-storage":"12","float32-filterable":"13","float32-blendable":"14","clip-distances":"15","dual-source-blending":"16",md:"17","core-features-and-limits":"18","chromium-experimental-unorm16-texture-formats":"327692","chromium-experimental-snorm16-texture-formats":"327693","chromium-experimental-multi-draw-indirect":"327732"};function rN(e,t,r,i,n,o){t=ew(t),r=ew(r),i>>>=0,n>>>=0,o>>>=0,e=rI(e>>>0);var s={};if(o){var u=W()[o+12>>>2>>>0];if(u){var l=W()[o+16>>>2>>>0];s.requiredFeatures=Array.from(W().subarray(l>>>2>>>0,l+4*u>>>2>>>0),e=>rP[e])}var f=W()[o+20>>>2>>>0];if(f){let e=function(e,t,r=!1){t=f+t,0xffffffff==(t=W()[t>>>2>>>0])||r&&0==t||(d[e]=t)},t=function(e,t){t=f+t;var r=W()[t>>>2>>>0],i=W()[t+4>>>2>>>0];0xffffffff==r&&0xffffffff==i||(d[e]=0x100000000*W()[t+4>>>2>>>0]+W()[t>>>2>>>0])};var d={};e("maxTextureDimension1D",4),e("maxTextureDimension2D",8),e("maxTextureDimension3D",12),e("maxTextureArrayLayers",16),e("maxBindGroups",20),e("maxBindGroupsPlusVertexBuffers",24),e("maxDynamicUniformBuffersPerPipelineLayout",32),e("maxDynamicStorageBuffersPerPipelineLayout",36),e("maxSampledTexturesPerShaderStage",40),e("maxSamplersPerShaderStage",44),e("maxStorageBuffersPerShaderStage",48),e("maxStorageTexturesPerShaderStage",52),e("maxUniformBuffersPerShaderStage",56),e("minUniformBufferOffsetAlignment",80),e("minStorageBufferOffsetAlignment",84),t("maxUniformBufferBindingSize",64),t("maxStorageBufferBindingSize",72),e("maxVertexBuffers",88),t("maxBufferSize",96),e("maxVertexAttributes",104),e("maxVertexBufferArrayStride",108),e("maxInterStageShaderVariables",112),e("maxColorAttachments",116),e("maxColorAttachmentBytesPerSample",120),e("maxComputeWorkgroupStorageSize",124),e("maxComputeInvocationsPerWorkgroup",128),e("maxComputeWorkgroupSizeX",132),e("maxComputeWorkgroupSizeY",136),e("maxComputeWorkgroupSizeZ",140),e("maxComputeWorkgroupsPerDimension",144),e("maxImmediateSize",148,!0),s.requiredLimits=d}(u=W()[o+24>>>2>>>0])&&(s.defaultQueue=u={label:rB(u+4)}),s.label=rB(o+4)}ei+=1,rO(t,e.requestDevice(s).then(e=>{--ei,rE(n,e.queue),rE(i,e),r&&(ei+=1,rO(r,e.lost.then(t=>{--ei,e.onuncapturederror=()=>{};var i=nn(),n=rT(t.message);iQ(r,rM[t.reason],n),nr(i)}))),e.onuncapturederror=e=>{var t=5;e.error instanceof GPUValidationError?t=2:e.error instanceof GPUOutOfMemoryError?t=3:e.error instanceof GPUInternalError&&(t=4);var r=nn();e=rT(e.error.message),i2(i,t,e),nr(r)},i1(t,1,i,0)},e=>{--ei;var n=nn();e=rT(e.message),i1(t,3,i,e),r&&iQ(r,4,e),nr(n)}))}function rW(e){var t=rI(e>>>=0),r=rx[e];if(r){for(var i=0;i<r.length;++i)r[i]();delete rx[e]}t.destroy()}var rG=()=>{var e="getMappedRange size=0 no longer means WGPU_WHOLE_MAP_SIZE";rG.kc||(rG.kc={}),rG.kc[e]||(rG.kc[e]=1,M(e))};function rF(e,t,r){t>>>=0,r>>>=0;var i=rI(e>>>=0);0===r&&rG(),0xffffffff==r&&(r=void 0);try{var n=i.getMappedRange(t,r)}catch{return 0}var o=ne(16,n.byteLength);return $().set(new Uint8Array(n),o>>>0),rx[e].push(()=>i$(o)),o}function rV(e,t,r){t>>>=0,r>>>=0;var i=rI(e>>>=0);0===r&&rG(),0xffffffff==r&&(r=void 0);try{var n=i.getMappedRange(t,r)}catch{return 0}var o=ne(16,n.byteLength);return $().fill(0,o,n.byteLength),rx[e].push(()=>{new Uint8Array(n).set($().subarray(o>>>0,o+n.byteLength>>>0)),i$(o)}),o}function rz(e,t,r,i,n){e>>>=0,t=ew(t),r=ew(r),n>>>=0;var o=rI(e);rx[e]=[],0xffffffff==n&&(n=void 0),ei+=1,rO(t,o.mapAsync(r,i>>>0,n).then(()=>{--ei,iK(t,1,0)},r=>{--ei,nn();var i=rT(r.message);iK(t,"AbortError"===r.name?4:3*("OperationError"===r.name),i),delete rx[e]}))}function rH(e){var t=rI(e>>>=0),r=rx[e];if(r){for(var i=0;i<r.length;++i)r[i]();delete rx[e],t.unmap()}}function rq(e){delete r_[e>>>0]}function rY(e,t,r){e>>>=0,t>>>=0,r>>>=0;var i=!!W()[t+32>>>2>>>0];t={label:rB(t+4),usage:W()[t+16>>>2>>>0],size:0x100000000*W()[t+28>>>2>>>0]+W()[t+24>>>2>>>0],mappedAtCreation:i},e=rI(e);try{var n=e.createBuffer(t)}catch{return!1}return rE(r,n),i&&(rx[r]=[]),!0}function rZ(e,t,r){e>>>=0,t>>>=0,r>>>=0;var i=W()[t>>>2>>>0],n=W()[i+4>>>2>>>0];t={label:rB(t+4),code:""},2===n&&(t.code=rU(i+8)),rE(r,rI(e).createShaderModule(t))}var rX=e=>{rI(e).destroy()};function rQ(e,t){t=ew(t),e=rI(e>>>0),ei+=1,rO(t,e.popErrorScope().then(e=>{--ei;var r=5;e?e instanceof GPUValidationError?r=2:e instanceof GPUOutOfMemoryError?r=3:e instanceof GPUInternalError&&(r=4):r=1;var i=nn();e=e?rT(e.message):0,iJ(t,1,r,e),nr(i)},e=>{--ei;var r=nn();e=rT(e.message),iJ(t,1,5,e),nr(r)}))}function rK(e,t,r,i){if(t=ew(t),i>>>=0,r>>>=0){var n=W()[r+4>>>2>>>0];n={featureLevel:rL[n],powerPreference:r$[W()[r+8>>>2>>>0]],forceFallbackAdapter:!!W()[r+12>>>2>>>0]},0!==(r=W()[r>>>2>>>0])&&(W(),n.rd=!!W()[r+8>>>2>>>0])}"gpu"in navigator?(ei+=1,rO(t,navigator.gpu.requestAdapter(n).then(e=>{if(--ei,e)rE(i,e),i0(t,1,i,0);else{e=nn();var r=rT("WebGPU not available on this browser (requestAdapter returned null)");i0(t,3,i,r),nr(e)}},e=>{--ei;var r=nn();e=rT(e.message),i0(t,4,i,e),nr(r)}))):(r=nn(),n=rT("WebGPU not available on this browser (navigator.gpu is not available)"),i0(t,3,i,n),nr(r))}function rJ(e,t,r){return e>>>=0,t>>>=0,r>>>=0,tj(async()=>{var i=[];if(r){var n=N()[r>>>2>>>0];i.length=t+1,i[t]=new Promise(e=>setTimeout(e,n,0))}else i.length=t;for(var o=0;o<t;++o){var s=0x100000000*W()[e+8*o+4>>>2>>>0]+W()[e+8*o>>>2>>>0];if(!(s in rA))return s;i[o]=rA[s]}return i=await Promise.race(i),delete rA[i],i})}var r0,r1={},r2=()=>{if(!r0){var e,t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(e in r1)void 0===r1[e]?delete t[e]:t[e]=r1[e];var r=[];for(e in t)r.push(`${e}=${t[e]}`);r0=r}return r0};function r3(e,t){if(s)return en(19,1,e,t);e>>>=0,t>>>=0;var r,i=0,n=0;for(r of r2()){var o=t+i;W()[e+n>>>2>>>0]=o,i+=e7(r,o,1/0)+1,n+=4}return 0}function r4(e,t){if(s)return en(20,1,e,t);e>>>=0,t>>>=0;var r=r2();for(var i of(W()[e>>>2>>>0]=r.length,e=0,r))e+=e9(i)+1;return W()[t>>>2>>>0]=e,0}function r6(e){return s?en(21,1,e):52}function r8(e,t,r,i){return s?en(22,1,e,t,r,i):52}function r5(e,t,r,i){return s?en(23,1,e,t,r,i):70}var r7=[null,[],[]];function r9(e,t,r,i){if(s)return en(24,1,e,t,r,i);t>>>=0,r>>>=0,i>>>=0;for(var n=0,o=0;o<r;o++){var u=W()[t>>>2>>>0],l=W()[t+4>>>2>>>0];t+=8;for(var f=0;f<l;f++){var d=$()[u+f>>>0],c=r7[e];0===d||10===d?((1===e?R:M)(eE(c)),c.length=0):c.push(d)}n+=l}return W()[i>>>2>>>0]=n,0}function ie(e,t){return rR(rI(e>>>0).limits,t>>>0),1}function it(e,t){return rI(e>>>0).features.has(rP[t])}function ir(e){return BigInt(rI(e>>>0).size)}function ii(e){return BigInt(rI(e>>>0).usage)}function ia(e,t){if(e>>>=0,t>>>=0){var r=rB(t+4);r={label:r,timestampWrites:t=0!==(t=W()[t+12>>>2>>>0])?{querySet:rI(W()[t+4>>>2>>>0]),beginningOfPassWriteIndex:W()[t+8>>>2>>>0],endOfPassWriteIndex:W()[t+12>>>2>>>0]}:void 0}}return e=rI(e),rE(t=iz(0),e.beginComputePass(r)),t}function io(e,t,r,i,n,o){r=ew(r),n=ew(n),o=ew(o),rI(e>>>0).copyBufferToBuffer(rI(t>>>0),r,rI(i>>>0),n,o)}function is(e){e=rI(e>>>0);var t=iF(0);return rE(t,e.finish()),t}function iu(e,t,r,i,n,o){o=ew(o),rI(e>>>0).resolveQuerySet(rI(t>>>0),r,i,rI(n>>>0),o)}function il(e,t,r,i){rI(e>>>0).dispatchWorkgroups(t,r,i)}function id(e){rI(e>>>0).end()}function ic(e,t,r,i,n){i>>>=0,n>>>=0,e=rI(e>>>0),r=rI(r>>>0),0==i?e.setBindGroup(t,r):e.setBindGroup(t,r,W(),n>>>2,i)}function ip(e,t){rI(e>>>0).setPipeline(rI(t>>>0))}function ih(e,t,r){rI(e>>>0).qd(rI(t>>>0),r)}function iy(e,t){e=rI(e>>>0);var r=iG(0);return rE(r,e.getBindGroupLayout(t)),r}function im(e,t){e>>>=0;var r=rB(4+(t>>>=0)),i=rI(W()[t+12>>>2>>>0]),n=W()[t+16>>>2>>>0];t=W()[t+20>>>2>>>0];for(var o=[],s=0;s<n;++s){var u=o.push,l=t+40*s,f=W()[l+8>>>2>>>0],d=W()[l+32>>>2>>>0],c=W()[l+36>>>2>>>0],p=W()[l+4>>>2>>>0];f?(d=l+24,-1==(d=W()[d>>>2>>>0]+0x100000000*N()[d+4>>>2>>>0])&&(d=void 0),l={binding:p,resource:{buffer:rI(f),offset:0x100000000*W()[l+4+16>>>2>>>0]+W()[l+16>>>2>>>0],size:d}}):l=d?{binding:p,resource:rI(d)}:{binding:p,resource:rI(c)},u.call(o,l)}return r={label:r,layout:i,entries:o},e=rI(e),rE(i=iW(0),e.createBindGroup(r)),i}function ig(e,t){var r;return e>>>=0,(t>>>=0)&&(r={label:rB(t+4)}),e=rI(e),rE(t=iV(0),e.createCommandEncoder(r)),t}function ib(e,t){e>>>=0;var r=t>>>0;t=rB(r+4);var i=(i=W()[r+12>>>2>>>0])?rI(i):"auto";if(r+=16){var n=rI(W()[r+4>>>2>>>0]),o=W()[r+16>>>2>>>0],s=W()[r+20>>>2>>>0];if(o){for(var u={},l=0;l<o;++l){var f=s+24*l;u[rU(f+4)]=F()[f+16>>>3>>>0]}o=u}else o=void 0;r={module:n,constants:o,entryPoint:rB(r+8)}}else r=void 0;return t={label:t,layout:i,compute:r},e=rI(e),rE(i=iH(0),e.createComputePipeline(t)),i}function iw(e,t){e>>>=0,t>>>=0,t={type:rk[W()[t+12>>>2>>>0]],count:W()[t+16>>>2>>>0]},e=rI(e);var r=iq(0);return rE(r,e.createQuerySet(t)),r}function iv(e,t){e=rI(e>>>0).adapterInfo,t>>>=0,N()[t+52>>>2>>>0]=e.subgroupMinSize,N()[t+56>>>2>>>0]=e.subgroupMaxSize;var r=e.vendor+e.architecture+e.device+e.description,i=e9(r)+1,n=ik(i);return n&&e7(r,n,i),rS(t+4,r=n,i=e9(e.vendor)),rS(t+12,r+=i,i=e9(e.architecture)),rS(t+20,r+=i,i=e9(e.device)),rS(t+28,r+i,e9(e.description)),N()[t+36>>>2>>>0]=2,e=e.isFallbackAdapter?3:4,N()[t+40>>>2>>>0]=e,N()[t+44>>>2>>>0]=0,N()[t+48>>>2>>>0]=0,1}function iC(e,t){t>>>=0,e=rI(e>>>0);var r=ik(4*e.features.size),i=0,n=0;e.features.forEach(e=>{void 0!==(e=rD[e])&&(N()[r+i>>>2>>>0]=e,i+=4,n++)}),W()[t+4>>>2>>>0]=r,W()[t>>>2>>>0]=n}function iT(e,t){return rR(rI(e>>>0).limits,t>>>0),1}function i_(e,t){return rI(e>>>0).features.has(rP[t])}function iE(e,t){rI(e>>>0).pushErrorScope(rj[t])}function ix(e,t,r){t>>>=0,r>>>=0,e=rI(e>>>0),t=Array.from(N().subarray(r>>>2>>>0,r+4*t>>>2>>>0),e=>rI(e)),e.submit(t)}function iA(e,t,r,i,n){r=ew(r),i>>>=0,n>>>=0,e=rI(e>>>0),t=rI(t>>>0),i=$().subarray(i>>>0,i+n>>>0),e.writeBuffer(t,r,i,0,n)}s||function(){for(var t=e.numThreads-1;t--;)ey();et.push(()=>{var e;Y++,e=()=>X(),s?e():Promise.all(eu.map(eh)).then(e)})}();for(var iO=Array(256),iI=0;256>iI;++iI)iO[iI]=String.fromCharCode(iI);eD=iO,eK.push(0,1,void 0,1,null,1,!0,1,!1,1),e.count_emval_handles=()=>eK.length/2-5-eQ.length,s||(m=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),z()),e.wasmBinary&&(y=e.wasmBinary),e.stackSave=()=>nn(),e.stackRestore=e=>nr(e),e.stackAlloc=e=>ni(e),e.setValue=function(e,t,r="i8"){switch(r.endsWith("*")&&(r="*"),r){case"i1":case"i8":P()[e>>>0]=t;break;case"i16":k()[e>>>1>>>0]=t;break;case"i32":N()[e>>>2>>>0]=t;break;case"i64":A[e>>>3]=BigInt(t);break;case"float":G()[e>>>2>>>0]=t;break;case"double":F()[e>>>3>>>0]=t;break;case"*":W()[e>>>2>>>0]=t;break;default:Q(`invalid type for setValue: ${r}`)}},e.getValue=function(e,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":case"i8":return P()[e>>>0];case"i16":return k()[e>>>1>>>0];case"i32":return N()[e>>>2>>>0];case"i64":return A[e>>>3];case"float":return G()[e>>>2>>>0];case"double":return F()[e>>>3>>>0];case"*":return W()[e>>>2>>>0];default:Q(`invalid type for getValue: ${t}`)}},e.UTF8ToString=ex,e.stringToUTF8=e7,e.lengthBytesUTF8=e9;var iS=[ea,eo,eC,eA,eO,eI,eS,eU,eB,eR,eM,ej,eL,eP,e$,ek,t5,t7,rt,r3,r4,r6,r8,r5,r9],iU={1048636:(t,r,i,n,o)=>{if(void 0===e||!e.fc)return 1;if((t=ex(Number(t>>>0))).startsWith("./")&&(t=t.substring(2)),!(t=e.fc.get(t)))return 2;if(r=Number(r>>>0),i=Number(i>>>0),n=Number(n>>>0),r+i>t.byteLength)return 3;try{let s=t.subarray(r,r+i);switch(o){case 0:$().set(s,n>>>0);break;case 1:e.Pc?e.Pc(n,s):e.jd(n,s);break;default:return 4}return 0}catch{return 4}},1049460:(t,r,i)=>{e.Rc(t,$().subarray(r>>>0,r+i>>>0))},1049524:()=>e.ed(),1049566:t=>{e.Qc(t)},1049603:()=>"u">typeof wasmOffsetConverter};function iB(){return"u">typeof wasmOffsetConverter}var iR=await async function(){function t(e,t){var r,i,n;let o;return iR=e.exports,r=iR=function(){var e={};for(let[t,r]of Object.entries(iR))e[t]="function"==typeof r?(...e)=>{tI.push(t);try{return r(...e)}finally{j||(tI.pop(),tA&&1===tx&&0===tI.length&&(tx=0,ei+=1,tE(ns),"u">typeof Fibers&&Fibers.od()))}}:r;return e}(),i=e=>t=>e(t)>>>0,n=e=>()=>e()>>>0,(r=Object.assign({},r)).ob=i(r.ob),r.Rb=n(r.Rb),r.Tb=i(r.Tb),r.Dc=(o=r.Dc,(e,t)=>o(e,t)>>>0),r.Gc=i(r.Gc),r.Hc=n(r.Hc),r.__cxa_get_exception_ptr=i(r.__cxa_get_exception_ptr),iR=r,ef.push(iR.vc),g=t,X(),iR}Y++;var i=K();if(e.instantiateWasm)return new Promise(r=>{e.instantiateWasm(i,(e,i)=>{r(t(e,i))})});if(s)return new Promise(e=>{S=r=>{e(t(new WebAssembly.Instance(r,K()),r))}});q??=e.locateFile?e.locateFile?e.locateFile("ort-wasm-simd-threaded.asyncify.wasm",h):h+"ort-wasm-simd-threaded.asyncify.wasm":new URL("ort-wasm-simd-threaded.asyncify.wasm",import.meta.url).href;try{var n=await async function(e){if(!y&&"function"==typeof WebAssembly.instantiateStreaming&&!L(q))try{var t=fetch(q,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(t,e)}catch(e){M(`wasm streaming compile failed: ${e}`),M("falling back to ArrayBuffer instantiation")}return async function(e,t){try{var r=await async function(e){if(!y)try{var t=await f(e);return new Uint8Array(t)}catch{}if(e==q&&y)e=new Uint8Array(y);else{if(!d)throw"both async and sync fetching of the wasm failed";e=d(e)}return e}(e);return await WebAssembly.instantiate(r,t)}catch(e){M(`failed to asynchronously prepare wasm: ${e}`),Q(e)}}(q,e)}(i);return t(n.instance,n.module)}catch(e){return r(e),Promise.reject(e)}}(),iM=e=>(iM=iR.ob)(e),ij=()=>(ij=iR.pb)();e._OrtInit=(t,r)=>(e._OrtInit=iR.qb)(t,r),e._OrtGetLastError=(t,r)=>(e._OrtGetLastError=iR.rb)(t,r),e._OrtCreateSessionOptions=(t,r,i,n,o,s,u,l,f,d)=>(e._OrtCreateSessionOptions=iR.sb)(t,r,i,n,o,s,u,l,f,d),e._OrtAppendExecutionProvider=(t,r,i,n,o)=>(e._OrtAppendExecutionProvider=iR.tb)(t,r,i,n,o),e._OrtAddFreeDimensionOverride=(t,r,i)=>(e._OrtAddFreeDimensionOverride=iR.ub)(t,r,i),e._OrtAddSessionConfigEntry=(t,r,i)=>(e._OrtAddSessionConfigEntry=iR.vb)(t,r,i),e._OrtReleaseSessionOptions=t=>(e._OrtReleaseSessionOptions=iR.wb)(t),e._OrtCreateSession=(t,r,i)=>(e._OrtCreateSession=iR.xb)(t,r,i),e._OrtReleaseSession=t=>(e._OrtReleaseSession=iR.yb)(t),e._OrtGetInputOutputCount=(t,r,i)=>(e._OrtGetInputOutputCount=iR.zb)(t,r,i),e._OrtGetInputOutputMetadata=(t,r,i,n)=>(e._OrtGetInputOutputMetadata=iR.Ab)(t,r,i,n),e._OrtFree=t=>(e._OrtFree=iR.Bb)(t),e._OrtCreateTensor=(t,r,i,n,o,s)=>(e._OrtCreateTensor=iR.Cb)(t,r,i,n,o,s),e._OrtGetTensorData=(t,r,i,n,o)=>(e._OrtGetTensorData=iR.Db)(t,r,i,n,o),e._OrtReleaseTensor=t=>(e._OrtReleaseTensor=iR.Eb)(t),e._OrtCreateRunOptions=(t,r,i,n)=>(e._OrtCreateRunOptions=iR.Fb)(t,r,i,n),e._OrtAddRunConfigEntry=(t,r,i)=>(e._OrtAddRunConfigEntry=iR.Gb)(t,r,i),e._OrtReleaseRunOptions=t=>(e._OrtReleaseRunOptions=iR.Hb)(t),e._OrtCreateBinding=t=>(e._OrtCreateBinding=iR.Ib)(t),e._OrtBindInput=(t,r,i)=>(e._OrtBindInput=iR.Jb)(t,r,i),e._OrtBindOutput=(t,r,i,n)=>(e._OrtBindOutput=iR.Kb)(t,r,i,n),e._OrtClearBoundOutputs=t=>(e._OrtClearBoundOutputs=iR.Lb)(t),e._OrtReleaseBinding=t=>(e._OrtReleaseBinding=iR.Mb)(t),e._OrtRunWithBinding=(t,r,i,n,o)=>(e._OrtRunWithBinding=iR.Nb)(t,r,i,n,o),e._OrtRun=(t,r,i,n,o,s,u,l)=>(e._OrtRun=iR.Ob)(t,r,i,n,o,s,u,l),e._OrtEndProfiling=t=>(e._OrtEndProfiling=iR.Pb)(t);var iL=e._OrtGetWebGpuDevice=t=>(iL=e._OrtGetWebGpuDevice=iR.Qb)(t),iP=()=>(iP=iR.Rb)(),i$=e._free=t=>(i$=e._free=iR.Sb)(t),ik=e._malloc=t=>(ik=e._malloc=iR.Tb)(t),iD=e._wgpuBufferRelease=t=>(iD=e._wgpuBufferRelease=iR.Ub)(t),iN=e._wgpuCreateInstance=t=>(iN=e._wgpuCreateInstance=iR.Vb)(t),iW=e=>(iW=iR.Wb)(e),iG=e=>(iG=iR.Xb)(e),iF=e=>(iF=iR.Yb)(e),iV=e=>(iV=iR.Zb)(e),iz=e=>(iz=iR._b)(e),iH=e=>(iH=iR.$b)(e),iq=e=>(iq=iR.bc)(e),iY=(e,t)=>(iY=iR.lc)(e,t),iZ=(e,t)=>(iZ=iR.mc)(e,t),iX=e=>(iX=iR.nc)(e),iQ=(e,t,r)=>(iQ=iR.pc)(e,t,r),iK=(e,t,r)=>(iK=iR.qc)(e,t,r),iJ=(e,t,r,i)=>(iJ=iR.rc)(e,t,r,i),i0=(e,t,r,i)=>(i0=iR.sc)(e,t,r,i),i1=(e,t,r,i)=>(i1=iR.tc)(e,t,r,i),i2=(e,t,r)=>(i2=iR.uc)(e,t,r),i3=(e,t,r,i,n,o)=>(i3=iR.wc)(e,t,r,i,n,o),i4=()=>(i4=iR.xc)(),i6=(e,t,r,i,n)=>(i6=iR.yc)(e,t,r,i,n),i8=e=>(i8=iR.zc)(e),i5=e=>(i5=iR.Ac)(e),i7=(e,t)=>(i7=iR.Bc)(e,t),i9=()=>(i9=iR.Cc)(),ne=(e,t)=>(ne=iR.Dc)(e,t),nt=(e,t)=>(nt=iR.Ec)(e,t),nr=e=>(nr=iR.Fc)(e),ni=e=>(ni=iR.Gc)(e),nn=()=>(nn=iR.Hc)(),na=e.dynCall_ii=(t,r)=>(na=e.dynCall_ii=iR.Ic)(t,r);e.dynCall_viiii=(t,r,i,n,o)=>(e.dynCall_viiii=iR.dynCall_viiii)(t,r,i,n,o),e.dynCall_viiiii=(t,r,i,n,o,s)=>(e.dynCall_viiiii=iR.dynCall_viiiii)(t,r,i,n,o,s),e.dynCall_viii=(t,r,i,n)=>(e.dynCall_viii=iR.Jc)(t,r,i,n),e.dynCall_vi=(t,r)=>(e.dynCall_vi=iR.dynCall_vi)(t,r),e.dynCall_viijj=(t,r,i,n,o)=>(e.dynCall_viijj=iR.dynCall_viijj)(t,r,i,n,o),e.dynCall_viiiiii=(t,r,i,n,o,s,u)=>(e.dynCall_viiiiii=iR.dynCall_viiiiii)(t,r,i,n,o,s,u),e.dynCall_viiiiiiii=(t,r,i,n,o,s,u,l,f)=>(e.dynCall_viiiiiiii=iR.dynCall_viiiiiiii)(t,r,i,n,o,s,u,l,f),e.dynCall_i=t=>(e.dynCall_i=iR.dynCall_i)(t),e.dynCall_vii=(t,r,i)=>(e.dynCall_vii=iR.dynCall_vii)(t,r,i),e.dynCall_fffffff=(t,r,i,n,o,s,u)=>(e.dynCall_fffffff=iR.dynCall_fffffff)(t,r,i,n,o,s,u),e.dynCall_iiiii=(t,r,i,n,o)=>(e.dynCall_iiiii=iR.dynCall_iiiii)(t,r,i,n,o),e.dynCall_iii=(t,r,i)=>(e.dynCall_iii=iR.dynCall_iii)(t,r,i),e.dynCall_iiiiii=(t,r,i,n,o,s)=>(e.dynCall_iiiiii=iR.dynCall_iiiiii)(t,r,i,n,o,s),e.dynCall_iiiiiiii=(t,r,i,n,o,s,u,l)=>(e.dynCall_iiiiiiii=iR.dynCall_iiiiiiii)(t,r,i,n,o,s,u,l),e.dynCall_iiiiiii=(t,r,i,n,o,s,u)=>(e.dynCall_iiiiiii=iR.dynCall_iiiiiii)(t,r,i,n,o,s,u),e.dynCall_iiii=(t,r,i,n)=>(e.dynCall_iiii=iR.dynCall_iiii)(t,r,i,n),e.dynCall_vfiii=(t,r,i,n,o)=>(e.dynCall_vfiii=iR.dynCall_vfiii)(t,r,i,n,o),e.dynCall_viiiiff=(t,r,i,n,o,s,u)=>(e.dynCall_viiiiff=iR.dynCall_viiiiff)(t,r,i,n,o,s,u),e.dynCall_viiiiiff=(t,r,i,n,o,s,u,l)=>(e.dynCall_viiiiiff=iR.dynCall_viiiiiff)(t,r,i,n,o,s,u,l),e.dynCall_ffff=(t,r,i,n)=>(e.dynCall_ffff=iR.dynCall_ffff)(t,r,i,n),e.dynCall_viiff=(t,r,i,n,o)=>(e.dynCall_viiff=iR.dynCall_viiff)(t,r,i,n,o),e.dynCall_jjjjjjj=(t,r,i,n,o,s,u)=>(e.dynCall_jjjjjjj=iR.dynCall_jjjjjjj)(t,r,i,n,o,s,u),e.dynCall_jjjjjj=(t,r,i,n,o,s)=>(e.dynCall_jjjjjj=iR.dynCall_jjjjjj)(t,r,i,n,o,s),e.dynCall_iijjii=(t,r,i,n,o,s)=>(e.dynCall_iijjii=iR.dynCall_iijjii)(t,r,i,n,o,s),e.dynCall_viiiiiiiiiiiii=(t,r,i,n,o,s,u,l,f,d,c,p,h,y)=>(e.dynCall_viiiiiiiiiiiii=iR.dynCall_viiiiiiiiiiiii)(t,r,i,n,o,s,u,l,f,d,c,p,h,y),e.dynCall_viiiiiiiiii=(t,r,i,n,o,s,u,l,f,d,c)=>(e.dynCall_viiiiiiiiii=iR.dynCall_viiiiiiiiii)(t,r,i,n,o,s,u,l,f,d,c),e.dynCall_viiiiiiiiiii=(t,r,i,n,o,s,u,l,f,d,c,p)=>(e.dynCall_viiiiiiiiiii=iR.dynCall_viiiiiiiiiii)(t,r,i,n,o,s,u,l,f,d,c,p),e.dynCall_viiiiiiiiiiii=(t,r,i,n,o,s,u,l,f,d,c,p,h)=>(e.dynCall_viiiiiiiiiiii=iR.dynCall_viiiiiiiiiiii)(t,r,i,n,o,s,u,l,f,d,c,p,h),e.dynCall_viiiiiiiiiiiiiiiiii=(t,r,i,n,o,s,u,l,f,d,c,p,h,y,m,g,b,w,v)=>(e.dynCall_viiiiiiiiiiiiiiiiii=iR.dynCall_viiiiiiiiiiiiiiiiii)(t,r,i,n,o,s,u,l,f,d,c,p,h,y,m,g,b,w,v),e.dynCall_viiiiiiiii=(t,r,i,n,o,s,u,l,f,d)=>(e.dynCall_viiiiiiiii=iR.dynCall_viiiiiiiii)(t,r,i,n,o,s,u,l,f,d),e.dynCall_viiiiiiiiiiiiiiiiiii=(t,r,i,n,o,s,u,l,f,d,c,p,h,y,m,g,b,w,v,C)=>(e.dynCall_viiiiiiiiiiiiiiiiiii=iR.dynCall_viiiiiiiiiiiiiiiiiii)(t,r,i,n,o,s,u,l,f,d,c,p,h,y,m,g,b,w,v,C),e.dynCall_viiiiiii=(t,r,i,n,o,s,u,l)=>(e.dynCall_viiiiiii=iR.dynCall_viiiiiii)(t,r,i,n,o,s,u,l),e.dynCall_viiiiiiiiiiiiiii=(t,r,i,n,o,s,u,l,f,d,c,p,h,y,m,g)=>(e.dynCall_viiiiiiiiiiiiiii=iR.dynCall_viiiiiiiiiiiiiii)(t,r,i,n,o,s,u,l,f,d,c,p,h,y,m,g),e.dynCall_jiji=(t,r,i,n)=>(e.dynCall_jiji=iR.dynCall_jiji)(t,r,i,n),e.dynCall_v=t=>(e.dynCall_v=iR.dynCall_v)(t),e.dynCall_iidiiii=(t,r,i,n,o,s,u)=>(e.dynCall_iidiiii=iR.dynCall_iidiiii)(t,r,i,n,o,s,u),e.dynCall_ji=(t,r)=>(e.dynCall_ji=iR.dynCall_ji)(t,r),e.dynCall_vij=(t,r,i)=>(e.dynCall_vij=iR.dynCall_vij)(t,r,i),e.dynCall_viiijii=(t,r,i,n,o,s,u)=>(e.dynCall_viiijii=iR.dynCall_viiijii)(t,r,i,n,o,s,u),e.dynCall_viijiiiiiiiiiiiiii=(t,r,i,n,o,s,u,l,f,d,c,p,h,y,m,g,b,w)=>(e.dynCall_viijiiiiiiiiiiiiii=iR.dynCall_viijiiiiiiiiiiiiii)(t,r,i,n,o,s,u,l,f,d,c,p,h,y,m,g,b,w),e.dynCall_viiiji=(t,r,i,n,o,s)=>(e.dynCall_viiiji=iR.dynCall_viiiji)(t,r,i,n,o,s),e.dynCall_jfi=(t,r,i)=>(e.dynCall_jfi=iR.dynCall_jfi)(t,r,i),e.dynCall_fif=(t,r,i)=>(e.dynCall_fif=iR.dynCall_fif)(t,r,i),e.dynCall_jii=(t,r,i)=>(e.dynCall_jii=iR.dynCall_jii)(t,r,i),e.dynCall_viiiijii=(t,r,i,n,o,s,u,l)=>(e.dynCall_viiiijii=iR.dynCall_viiiijii)(t,r,i,n,o,s,u,l),e.dynCall_iij=(t,r,i)=>(e.dynCall_iij=iR.dynCall_iij)(t,r,i),e.dynCall_viji=(t,r,i,n)=>(e.dynCall_viji=iR.dynCall_viji)(t,r,i,n),e.dynCall_iiiiiiiii=(t,r,i,n,o,s,u,l,f)=>(e.dynCall_iiiiiiiii=iR.dynCall_iiiiiiiii)(t,r,i,n,o,s,u,l,f),e.dynCall_iiij=(t,r,i,n)=>(e.dynCall_iiij=iR.dynCall_iiij)(t,r,i,n),e.dynCall_iiiiiiiiii=(t,r,i,n,o,s,u,l,f,d)=>(e.dynCall_iiiiiiiiii=iR.dynCall_iiiiiiiiii)(t,r,i,n,o,s,u,l,f,d),e.dynCall_iiiiiiiiiiiii=(t,r,i,n,o,s,u,l,f,d,c,p,h)=>(e.dynCall_iiiiiiiiiiiii=iR.dynCall_iiiiiiiiiiiii)(t,r,i,n,o,s,u,l,f,d,c,p,h),e.dynCall_iiiiiiiiiii=(t,r,i,n,o,s,u,l,f,d,c)=>(e.dynCall_iiiiiiiiiii=iR.dynCall_iiiiiiiiiii)(t,r,i,n,o,s,u,l,f,d,c),e.dynCall_iijii=(t,r,i,n,o)=>(e.dynCall_iijii=iR.dynCall_iijii)(t,r,i,n,o),e.dynCall_fiii=(t,r,i,n)=>(e.dynCall_fiii=iR.dynCall_fiii)(t,r,i,n),e.dynCall_viijii=(t,r,i,n,o,s)=>(e.dynCall_viijii=iR.dynCall_viijii)(t,r,i,n,o,s),e.dynCall_viij=(t,r,i,n)=>(e.dynCall_viij=iR.dynCall_viij)(t,r,i,n),e.dynCall_jiij=(t,r,i,n)=>(e.dynCall_jiij=iR.dynCall_jiij)(t,r,i,n),e.dynCall_fi=(t,r)=>(e.dynCall_fi=iR.dynCall_fi)(t,r),e.dynCall_fii=(t,r,i)=>(e.dynCall_fii=iR.dynCall_fii)(t,r,i),e.dynCall_dii=(t,r,i)=>(e.dynCall_dii=iR.dynCall_dii)(t,r,i),e.dynCall_fiiii=(t,r,i,n,o)=>(e.dynCall_fiiii=iR.dynCall_fiiii)(t,r,i,n,o),e.dynCall_viiiiiiiiiiiiii=(t,r,i,n,o,s,u,l,f,d,c,p,h,y,m)=>(e.dynCall_viiiiiiiiiiiiii=iR.dynCall_viiiiiiiiiiiiii)(t,r,i,n,o,s,u,l,f,d,c,p,h,y,m),e.dynCall_viiiiiiiiiiiiiiiiiiii=(t,r,i,n,o,s,u,l,f,d,c,p,h,y,m,g,b,w,v,C,T)=>(e.dynCall_viiiiiiiiiiiiiiiiiiii=iR.dynCall_viiiiiiiiiiiiiiiiiiii)(t,r,i,n,o,s,u,l,f,d,c,p,h,y,m,g,b,w,v,C,T),e.dynCall_viiiiiiiiiiiiiiii=(t,r,i,n,o,s,u,l,f,d,c,p,h,y,m,g,b)=>(e.dynCall_viiiiiiiiiiiiiiii=iR.dynCall_viiiiiiiiiiiiiiii)(t,r,i,n,o,s,u,l,f,d,c,p,h,y,m,g,b),e.dynCall_iif=(t,r,i)=>(e.dynCall_iif=iR.dynCall_iif)(t,r,i),e.dynCall_jiiii=(t,r,i,n,o)=>(e.dynCall_jiiii=iR.dynCall_jiiii)(t,r,i,n,o),e.dynCall_jiii=(t,r,i,n)=>(e.dynCall_jiii=iR.dynCall_jiii)(t,r,i,n),e.dynCall_viif=(t,r,i,n)=>(e.dynCall_viif=iR.dynCall_viif)(t,r,i,n),e.dynCall_viiij=(t,r,i,n,o)=>(e.dynCall_viiij=iR.dynCall_viiij)(t,r,i,n,o),e.dynCall_iiiiij=(t,r,i,n,o,s)=>(e.dynCall_iiiiij=iR.dynCall_iiiiij)(t,r,i,n,o,s),e.dynCall_iiiiid=(t,r,i,n,o,s)=>(e.dynCall_iiiiid=iR.dynCall_iiiiid)(t,r,i,n,o,s),e.dynCall_iiiiijj=(t,r,i,n,o,s,u)=>(e.dynCall_iiiiijj=iR.dynCall_iiiiijj)(t,r,i,n,o,s,u),e.dynCall_iiiiiijj=(t,r,i,n,o,s,u,l)=>(e.dynCall_iiiiiijj=iR.dynCall_iiiiiijj)(t,r,i,n,o,s,u,l);var no=e=>(no=iR.Kc)(e),ns=()=>(ns=iR.Lc)(),nu=e=>(nu=iR.Mc)(e),nl=()=>(nl=iR.Nc)();return function r(){if(0<Y)Z=r;else if(s)t(e),H();else{for(;0<et.length;)et.shift()(e);0<Y?Z=r:(e.calledRun=!0,j||(H(),t(e)))}}(),e.PTR_SIZE=4,e.webgpuInit=t=>{let r=new WeakMap,i,n,o=1;e.webgpuRegisterDevice=e=>{if(void 0!==n)throw Error("another WebGPU EP inference session is being created.");if(e){var t=r.get(e);if(!t){let i=((e,t=0)=>{var r=iX(t);return t=iZ(t,r),rE(r,e.queue),rE(t,e),t})(e,t=iN(0));t=[o++,t,i],r.set(e,t)}return i=e,n=t[0],t}i=void 0,n=0};let s=new Map;e.webgpuOnCreateSession=e=>{if(void 0!==n){var r=n;if(n=void 0,e){let n=iL(r);s.set(e,n),0===r&&t(i??rI(n))}i=void 0}},e.webgpuOnReleaseSession=e=>{s.delete(e)};let u=Symbol("gpuBufferMetadata");e.webgpuRegisterBuffer=(e,t,r)=>{if(r)return e[u]=[r,NaN],r;if(r=e[u])return r[1]++,r[0];if(void 0===(t=s.get(t)))throw Error("Invalid session handle passed to webgpuRegisterBuffer");return t=((e,t=0)=>("pending"!=e.mapState||Q(),rE(t=iY(t,"mapped"==e.mapState?3:1),e),"mapped"==e.mapState&&(rx[t]=[]),t))(e,t),e[u]=[t,1],t},e.webgpuUnregisterBuffer=e=>{let t=e[u];if(!t)throw Error("Buffer is not registered");t[1]--,0===t[1]&&(iD(t[0]),delete e[u])},e.webgpuGetBuffer=e=>rI(e),e.webgpuCreateDownloader=(e,t,r)=>{if(void 0===(r=s.get(r)))throw Error("Invalid session handle passed to webgpuRegisterBuffer");let i=rI(r),n=16*Math.ceil(Number(t)/16);return async()=>{let r=i.createBuffer({size:n,usage:9});try{let o=i.createCommandEncoder();return o.copyBufferToBuffer(e,0,r,0,n),i.queue.submit([o.finish()]),await r.mapAsync(GPUMapMode.READ),r.getMappedRange().slice(0,t)}finally{r.destroy()}}},e.Pc=(e,t)=>{var r=t.buffer;let o=t.byteOffset,s=t.byteLength;if(t=16*Math.ceil(Number(s)/16),e=rI(e),!i){var u=iL(n);i=rI(u)}new Uint8Array((u=i.createBuffer({mappedAtCreation:!0,size:t,usage:6})).getMappedRange()).set(new Uint8Array(r,o,s)),u.unmap(),(r=i.createCommandEncoder()).copyBufferToBuffer(u,0,e,0,t),i.queue.submit([r.finish()]),u.destroy()}},e.webnnInit=t=>{let r=t[0];[e.ed,e.Qc,e.webnnEnsureTensor,e.Rc,e.webnnDownloadTensor,e.dd,e.webnnEnableTraceEvent]=t.slice(1),e.webnnReleaseTensorId=e.Qc,e.webnnUploadTensor=e.Rc,e.webnnRegisterMLContext=e.dd,e.webnnOnRunStart=e=>r.onRunStart(e),e.webnnOnRunEnd=r.onRunEnd.bind(r),e.webnnOnReleaseSession=e=>{r.onReleaseSession(e)},e.webnnCreateMLTensorDownloader=(e,t)=>r.createMLTensorDownloader(e,t),e.webnnRegisterMLTensor=(e,t,i,n)=>r.registerMLTensor(e,t,i,n),e.webnnCreateMLContext=e=>r.createMLContext(e),e.webnnRegisterMLConstant=(t,i,n,o,s,u)=>r.registerMLConstant(t,i,n,o,s,e.fc,u),e.webnnRegisterGraphInput=r.registerGraphInput.bind(r),e.webnnIsGraphInput=r.isGraphInput.bind(r),e.webnnRegisterGraphOutput=r.registerGraphOutput.bind(r),e.webnnIsGraphOutput=r.isGraphOutput.bind(r),e.webnnCreateTemporaryTensor=r.createTemporaryTensor.bind(r),e.webnnIsGraphInputOutputTypeSupported=r.isGraphInputOutputTypeSupported.bind(r)},i},globalThis.self?.name?.startsWith("em-pthread")&&ey()}),ta=N(()=>{"use strict";el(),eg=typeof location>"u"?void 0:location.origin,eb=import.meta.url>"file:"&&import.meta.url<"file;",ew=(()=>{if(eb){let e=URL;return new URL(new e("ort.webgpu.bundle.min.mjs",import.meta.url).href,eg).href}return import.meta.url})(),ev=()=>{if(ew&&!ew.startsWith("blob:"))return ew.substring(0,ew.lastIndexOf("/")+1)},eC=(e,t)=>{try{let r=t??ew;return(r?new URL(e,r):new URL(e)).origin===eg}catch{return!1}},eT=async e=>{let t=await (await fetch(e,{credentials:"same-origin"})).blob();return URL.createObjectURL(t)},e_=async e=>(await import(e)).default,eE=(ep(),G(ef)).default,ex=async()=>{if(!ew)throw Error("Failed to load proxy worker: cannot determine the script source URL.");if(eC(ew))return[void 0,eE()];let e=await eT(ew);return[e,eE(e)]},eA=(tn(),G(eh)).default,eO=async(e,t,r,i)=>{let n=eA&&!(e||t);if(n)if(ew)n=eC(ew);else if(i&&!r)n=!0;else throw Error("cannot determine the script source URL.");if(n)return[void 0,eA];{let i,n,o="ort-wasm-simd-threaded.asyncify.mjs",s=e??((e,t)=>{let r=t??ew;try{return(r?new URL(e,r):new URL(e)).href}catch{return}})(o,t),u=r&&s&&!eC(s,t),l=u?await eT(s):s??(i=o,n=t,`${n??"./"}${i}`);return[u?l:void 0,await e_(l)]}}}),to=N(()=>{"use strict";ta(),eS=!1,eU=!1,eB=!1,eR=async e=>{if(eS)return Promise.resolve();if(eU)throw Error("multiple calls to 'initializeWebAssembly()' detected.");if(eB)throw Error("previous call to 'initializeWebAssembly()' failed.");eU=!0;let t=e.initTimeout,r=e.numThreads;if(!1!==e.simd){if("relaxed"===e.simd){if(!(()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}})())throw Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!(()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}})())throw Error("WebAssembly SIMD is not supported in the current environment.")}let i=(()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return"u">typeof MessageChannel&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}})();r>1&&!i&&("u">typeof self&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+r+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),e.numThreads=r=1);let n=e.wasmPaths,o="string"==typeof n?n:void 0,s=n?.mjs,u=s?.href??s,l=n?.wasm,f=l?.href??l,d=e.wasmBinary,[c,p]=await eO(u,o,r>1,!!d||!!f),h=!1,y=[];if(t>0&&y.push(new Promise(e=>{setTimeout(()=>{h=!0,e()},t)})),y.push(new Promise((e,t)=>{let i={numThreads:r};if(d)i.wasmBinary=d;else if(f||o)i.locateFile=e=>f??o+e;else if(u&&0!==u.indexOf("blob:"))i.locateFile=e=>new URL(e,u).href;else if(c){let e=ev();e&&(i.locateFile=t=>e+t)}p(i).then(t=>{eU=!1,eS=!0,eI=t,e(),c&&URL.revokeObjectURL(c)},e=>{eU=!1,eB=!0,t(e)})})),await Promise.race(y),h)throw Error(`WebAssembly backend initializing failed due to timeout: ${t}ms`)},eM=()=>{if(eS&&eI)return eI;throw Error("WebAssembly is not initialized yet.")}}),ts=N(()=>{"use strict";to(),ej=(e,t)=>{let r=eM(),i=r.lengthBytesUTF8(e)+1,n=r._malloc(i);return r.stringToUTF8(e,n,i),t.push(n),n},eL=(e,t,r,i)=>{if("object"==typeof e&&null!==e){if(r.has(e))throw Error("Circular reference in options");r.add(e)}Object.entries(e).forEach(([e,n])=>{let o=t?t+e:e;if("object"==typeof n)eL(n,o+".",r,i);else if("string"==typeof n||"number"==typeof n)i(o,n.toString());else if("boolean"==typeof n)i(o,n?"1":"0");else throw Error(`Can't handle extra config type: ${typeof n}`)})},eP=e=>{let t=eM(),r=t.stackSave();try{let r=t.PTR_SIZE,i=t.stackAlloc(2*r);t._OrtGetLastError(i,i+r);let n=Number(t.getValue(i,4===r?"i32":"i64")),o=t.getValue(i+r,"*"),s=o?t.UTF8ToString(o):"";throw Error(`${e} ERROR_CODE: ${n}, ERROR_MESSAGE: ${s}`)}finally{t.stackRestore(r)}}}),tu=N(()=>{"use strict";to(),ts(),e$=e=>{let t=eM(),r=0,i=[],n=e||{};try{if(e?.logSeverityLevel===void 0)n.logSeverityLevel=2;else if("number"!=typeof e.logSeverityLevel||!Number.isInteger(e.logSeverityLevel)||e.logSeverityLevel<0||e.logSeverityLevel>4)throw Error(`log severity level is not valid: ${e.logSeverityLevel}`);if(e?.logVerbosityLevel===void 0)n.logVerbosityLevel=0;else if("number"!=typeof e.logVerbosityLevel||!Number.isInteger(e.logVerbosityLevel))throw Error(`log verbosity level is not valid: ${e.logVerbosityLevel}`);e?.terminate===void 0&&(n.terminate=!1);let o=0;return e?.tag!==void 0&&(o=ej(e.tag,i)),r=t._OrtCreateRunOptions(n.logSeverityLevel,n.logVerbosityLevel,!!n.terminate,o),0===r&&eP("Can't create run options."),e?.extra!==void 0&&eL(e.extra,"",new WeakSet,(e,n)=>{let o=ej(e,i),s=ej(n,i);0!==t._OrtAddRunConfigEntry(r,o,s)&&eP(`Can't set a run config entry: ${e} - ${n}.`)}),[r,i]}catch(e){throw 0!==r&&t._OrtReleaseRunOptions(r),i.forEach(e=>t._free(e)),e}}}),tl=N(()=>{"use strict";to(),ts(),ek=(e,t,r,i)=>{let n=ej(t,i),o=ej(r,i);0!==eM()._OrtAddSessionConfigEntry(e,n,o)&&eP(`Can't set a session config entry: ${t} - ${r}.`)},eD=(e,t,r,i)=>{let n=ej(t,i),o=ej(r,i);e.push([n,o])},eN=async(e,t,r)=>{for(let i of t){let t="string"==typeof i?i:i.name,n=[];switch(t){case"webnn":if(t="WEBNN","string"!=typeof i){let t=i?.deviceType;t&&ek(e,"deviceType",t,r)}break;case"webgpu":{let e;if(t="WebGPU","string"!=typeof i&&i.device)if("u">typeof GPUDevice&&i.device instanceof GPUDevice)e=i.device;else throw Error("Invalid GPU device set in WebGPU EP options.");let o=eM().webgpuRegisterDevice(e);if(o){let[e,t,i]=o;eD(n,"deviceId",e.toString(),r),eD(n,"webgpuInstance",t.toString(),r),eD(n,"webgpuDevice",i.toString(),r)}}break;case"wasm":case"cpu":continue;default:throw Error(`not supported execution provider: ${t}`)}let o=ej(t,r),s=n.length,u=0,l=0;if(s>0){u=eM()._malloc(s*eM().PTR_SIZE),r.push(u),l=eM()._malloc(s*eM().PTR_SIZE),r.push(l);for(let e=0;e<s;e++)eM().setValue(u+e*eM().PTR_SIZE,n[e][0],"*"),eM().setValue(l+e*eM().PTR_SIZE,n[e][1],"*")}await eM()._OrtAppendExecutionProvider(e,o,u,l,s)!==0&&eP(`Can't append execution provider: ${t}.`)}},eW=async e=>{var t;let r,i=eM(),n=0,o=[],s=e||{};(t=s).extra||(t.extra={}),t.extra.session||(t.extra.session={}),(r=t.extra.session).use_ort_model_bytes_directly||(r.use_ort_model_bytes_directly="1"),t.executionProviders&&t.executionProviders.some(e=>("string"==typeof e?e:e.name)==="webgpu")&&(t.enableMemPattern=!1);try{let e=(e=>{switch(e){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"layout":return 3;case"all":return 99;default:throw Error(`unsupported graph optimization level: ${e}`)}})(s.graphOptimizationLevel??"all"),t=(e=>{switch(e){case"sequential":return 0;case"parallel":return 1;default:throw Error(`unsupported execution mode: ${e}`)}})(s.executionMode??"sequential"),r="string"==typeof s.logId?ej(s.logId,o):0,u=s.logSeverityLevel??2;if(!Number.isInteger(u)||u<0||u>4)throw Error(`log severity level is not valid: ${u}`);let l=s.logVerbosityLevel??0;if(!Number.isInteger(l)||l<0||l>4)throw Error(`log verbosity level is not valid: ${l}`);let f="string"==typeof s.optimizedModelFilePath?ej(s.optimizedModelFilePath,o):0;if(n=i._OrtCreateSessionOptions(e,!!s.enableCpuMemArena,!!s.enableMemPattern,t,!!s.enableProfiling,0,r,u,l,f),0===n&&eP("Can't create session options."),s.executionProviders&&await eN(n,s.executionProviders,o),void 0!==s.enableGraphCapture){if("boolean"!=typeof s.enableGraphCapture)throw Error(`enableGraphCapture must be a boolean value: ${s.enableGraphCapture}`);ek(n,"enableGraphCapture",s.enableGraphCapture.toString(),o)}if(s.freeDimensionOverrides)for(let[e,t]of Object.entries(s.freeDimensionOverrides)){if("string"!=typeof e)throw Error(`free dimension override name must be a string: ${e}`);if("number"!=typeof t||!Number.isInteger(t)||t<0)throw Error(`free dimension override value must be a non-negative integer: ${t}`);let r=ej(e,o);0!==i._OrtAddFreeDimensionOverride(n,r,t)&&eP(`Can't set a free dimension override: ${e} - ${t}.`)}return void 0!==s.extra&&eL(s.extra,"",new WeakSet,(e,t)=>{ek(n,e,t,o)}),[n,o]}catch(e){throw 0!==n&&0!==i._OrtReleaseSessionOptions(n)&&eP("Can't release session options."),o.forEach(e=>i._free(e)),e}}}),tf=N(()=>{"use strict";eG=e=>{switch(e){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw Error(`unsupported data type: ${e}`)}},eF=e=>{switch(e){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw Error(`unsupported data type: ${e}`)}},eV=(e,t)=>{let r=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][e],i="number"==typeof t?t:t.reduce((e,t)=>e*t,1);return r>0?Math.ceil(i*r):void 0},ez=e=>{switch(e){case"float16":return"u">typeof Float16Array&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":case"bool":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw Error(`unsupported type: ${e}`)}},eH=e=>{switch(e){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw Error(`unsupported logging level: ${e}`)}},eq=e=>"float32"===e||"float16"===e||"int32"===e||"int64"===e||"uint32"===e||"uint8"===e||"bool"===e||"uint4"===e||"int4"===e,eY=e=>"float32"===e||"float16"===e||"int32"===e||"int64"===e||"uint32"===e||"uint64"===e||"int8"===e||"uint8"===e||"bool"===e||"uint4"===e||"int4"===e,eZ=e=>{switch(e){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw Error(`unsupported data location: ${e}`)}}}),td=N(()=>{"use strict";el(),eX=async e=>{if("string"!=typeof e)return e instanceof Blob?new Uint8Array(await e.arrayBuffer()):e instanceof Uint8Array?e:new Uint8Array(e);{let t=await fetch(e);if(!t.ok)throw Error(`failed to load external data file: ${e}`);let r=t.headers.get("Content-Length"),i=r?parseInt(r,10):0;if(i<0x40000000)return new Uint8Array(await t.arrayBuffer());{if(!t.body)throw Error(`failed to load external data file: ${e}, no response body.`);let r=t.body.getReader(),n;try{n=new ArrayBuffer(i)}catch(e){if(e instanceof RangeError){let e=Math.ceil(i/65536);n=new WebAssembly.Memory({initial:e,maximum:e}).buffer}else throw e}let o=0;for(;;){let{done:e,value:t}=await r.read();if(e)break;let i=t.byteLength;new Uint8Array(n,o,i).set(t),o+=i}return new Uint8Array(n,0,i)}}}}),tc=N(()=>{"use strict";tf(),eQ=(e,t)=>new(ez(t))(e)}),tp=N(()=>{"use strict";tf(),eK=["V","I","W","E","F"],e1=(e,t)=>{eJ=e,e0=t},e2=(...e)=>{e0&&((e,t)=>{var r,i;let n=eH(e);n>=eH(eJ)&&(r=n,i="function"==typeof t?t():t,console.log(`[${eK[r]},${new Date().toISOString()}]${i}`))})(...e)}}),th=N(()=>{"use strict";tf(),tp(),e3=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),e4=(e,t)=>{if("int32"===t)return e;let r=e3.get(t);if(!r)throw Error(`WebNN backend does not support data type: ${t}`);let i=r/8;if(e.byteLength%i!=0)throw Error(`Invalid Uint8Array length - must be a multiple of ${i}.`);let n=e.byteLength/i,o=new(ez(t))(e.buffer,e.byteOffset,n);switch(t){case"int64":case"uint64":{let e=new Int32Array(n);for(let t=0;t<n;t++){let r=o[t];if(r>2147483647n||r<-2147483648n)throw Error("Can not convert int64 data to int32 - value out of range.");e[t]=Number(r)}return new Uint8Array(e.buffer)}case"int8":case"uint8":case"uint32":if("uint32"===t&&o.some(e=>e>0x7fffffff))throw Error("Can not convert uint32 data to int32 - value out of range.");return new Uint8Array(Int32Array.from(o,Number).buffer);default:throw Error(`Unsupported data conversion from ${t} to 'int32'`)}},e6=(e,t)=>{if("int32"===t)return e;if(e.byteLength%4!=0)throw Error("Invalid Uint8Array length - must be a multiple of 4 (int32).");let r=e.byteLength/4,i=new Int32Array(e.buffer,e.byteOffset,r);switch(t){case"int64":return new Uint8Array(BigInt64Array.from(i,BigInt).buffer);case"uint64":if(i.some(e=>e<0))throw Error("Can not convert int32 data to uin64 - negative value found.");return new Uint8Array(BigUint64Array.from(i,BigInt).buffer);case"int8":if(i.some(e=>e<-128||e>127))throw Error("Can not convert int32 data to int8 - value out of range.");return new Uint8Array(Int8Array.from(i,Number).buffer);case"uint8":if(i.some(e=>e<0||e>255))throw Error("Can not convert int32 data to uint8 - value out of range.");return Uint8Array.from(i,Number);case"uint32":if(i.some(e=>e<0))throw Error("Can not convert int32 data to uint32 - negative value found.");return new Uint8Array(Uint32Array.from(i,Number).buffer);default:throw Error(`Unsupported data conversion from 'int32' to ${t}`)}},e8=1,e5=()=>e8++,e7=new Map([["int8","int32"],["uint8","int32"],["uint32","int32"],["int64","int32"]]),e9=(e,t)=>{let r=e3.get(e);if(!r)throw Error(`WebNN backend does not support data type: ${e}`);return t.length>0?Math.ceil(t.reduce((e,t)=>e*t)*r/8):0},te=class{constructor(e){this.isDataConverted=!1;let{sessionId:t,context:r,tensor:i,dataType:n,shape:o,fallbackDataType:s}=e;this.sessionId=t,this.mlContext=r,this.mlTensor=i,this.dataType=n,this.tensorShape=o,this.fallbackDataType=s}get tensor(){return this.mlTensor}get type(){return this.dataType}get fallbackType(){return this.fallbackDataType}get shape(){return this.tensorShape}get byteLength(){return e9(this.dataType,this.tensorShape)}destroy(){e2("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(e){this.mlContext.writeTensor(this.mlTensor,e)}async read(e){if(!this.fallbackDataType)return e?this.mlContext.readTensor(this.mlTensor,e):this.mlContext.readTensor(this.mlTensor);{let t=e6(new Uint8Array(await this.mlContext.readTensor(this.mlTensor)),this.dataType);return e?void(e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)).set(t):t.buffer}}canReuseTensor(e,t,r){return this.mlContext===e&&this.dataType===t&&this.tensorShape.length===r.length&&this.tensorShape.every((e,t)=>e===r[t])}setIsDataConverted(e){this.isDataConverted=e}},tt=class{constructor(e,t){this.tensorManager=e,this.wrapper=t}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(e,t,r,i){let n=this.tensorManager.getMLContext(e),o;if(!n.opSupportLimits().input.dataTypes.includes(t)){if(!(o=e7.get(t))||!n.opSupportLimits().input.dataTypes.includes(o))throw Error(`WebNN backend does not support data type: ${t}`);e2("verbose",()=>`[WebNN] TensorIdTracker.ensureTensor: fallback dataType from ${t} to ${o}`)}if(this.wrapper){if(this.wrapper.canReuseTensor(n,t,r))return this.wrapper.tensor;if(i){if(this.wrapper.byteLength!==e9(t,r))throw Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let s=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(e,t,r,s,!0,!0,o),i&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(e){let t=e;if(this.wrapper){if(this.wrapper.fallbackType)if("int32"===this.wrapper.fallbackType)t=e4(e,this.wrapper.type),this.wrapper.setIsDataConverted(!0);else throw Error(`Unsupported fallback data type: ${this.wrapper.fallbackType}`);if(e.byteLength===this.wrapper.byteLength)return void this.wrapper.write(t);e2("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor()}this.activeUpload?this.activeUpload.set(t):this.activeUpload=new Uint8Array(t)}async download(e){if(this.activeUpload){let t=this.wrapper?.isDataConverted?e6(this.activeUpload,this.wrapper?.type):this.activeUpload;return e?void(e instanceof ArrayBuffer?new Uint8Array(e).set(t):new Uint8Array(e.buffer,e.byteOffset,e.byteLength).set(t)):t.buffer}if(!this.wrapper)throw Error("Tensor has not been created.");return e?this.wrapper.read(e):this.wrapper.read()}},tr=class{constructor(e){this.backend=e,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(e){let t=this.backend.getMLContext(e);if(!t)throw Error("MLContext not found for session.");return t}reserveTensorId(){let e=e5();return this.tensorTrackersById.set(e,new tt(this)),e}releaseTensorId(e){let t=this.tensorTrackersById.get(e);t&&(this.tensorTrackersById.delete(e),t.tensorWrapper&&this.releaseTensor(t.tensorWrapper))}async ensureTensor(e,t,r,i,n){e2("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${t}, dataType: ${r}, shape: ${i}, copyOld: ${n}}`);let o=this.tensorTrackersById.get(t);if(!o)throw Error("Tensor not found.");return o.ensureTensor(e,r,i,n)}upload(e,t){let r=this.tensorTrackersById.get(e);if(!r)throw Error("Tensor not found.");r.upload(t)}async download(e,t){e2("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${e}, dstBuffer: ${t?.byteLength}}`);let r=this.tensorTrackersById.get(e);if(!r)throw Error("Tensor not found.");return r.download(t)}releaseTensorsForSession(e){for(let t of this.freeTensors)t.sessionId===e&&t.destroy();this.freeTensors=this.freeTensors.filter(t=>t.sessionId!==e)}registerTensor(e,t,r,i){let n=this.getMLContext(e),o=e5(),s=new te({sessionId:e,context:n,tensor:t,dataType:r,shape:i});return this.tensorTrackersById.set(o,new tt(this,s)),this.externalTensors.add(s),o}async getCachedTensor(e,t,r,i,n,o,s){let u=this.getMLContext(e);for(let[i,n]of this.freeTensors.entries())if(n.canReuseTensor(u,t,r)){e2("verbose",()=>`[WebNN] Reusing tensor {dataType: ${t}, ${s?`fallbackDataType: ${s},`:""} shape: ${r}`);let n=this.freeTensors.splice(i,1)[0];return n.sessionId=e,n}e2("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${t}, ${s?`fallbackDataType: ${s},`:""} shape: ${r}}`);let l=await u.createTensor({dataType:s??t,shape:r,dimensions:r,usage:i,writable:n,readable:o});return new te({sessionId:e,context:u,tensor:l,dataType:t,shape:r,fallbackDataType:s})}releaseTensor(e){this.externalTensors.has(e)&&this.externalTensors.delete(e),this.freeTensors.push(e)}},ti=(...e)=>new tr(...e)}),ty={};W(ty,{WebNNBackend:()=>tg});var tm,tg,tb,tw,tv,tC,tT,t_,tE,tx,tA,tO,tI,tS,tU,tB,tR,tM,tj,tL,tP,t$,tk,tD,tN,tW,tG,tF,tV,tz,tH,tq,tY,tZ,tX=N(()=>{"use strict";tf(),to(),tc(),th(),tp(),tm=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),tg=class{constructor(e){this.tensorManager=ti(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.sessionGraphOutputs=new Map,this.temporaryGraphInputs=[],this.temporaryGraphOutputs=[],this.temporarySessionTensorIds=new Map,e1(e.logLevel,!!e.debug)}get currentSessionId(){if(void 0===this.activeSessionId)throw Error("No active session");return this.activeSessionId}onRunStart(e){e2("verbose",()=>`[WebNN] onRunStart {sessionId: ${e}}`),this.activeSessionId=e}onRunEnd(e){e2("verbose",()=>`[WebNN] onRunEnd {sessionId: ${e}}`);let t=this.temporarySessionTensorIds.get(e);if(t){for(let e of t)e2("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${e}}`),this.tensorManager.releaseTensorId(e);this.temporarySessionTensorIds.delete(e),this.activeSessionId=void 0}}async createMLContext(e){if(e instanceof GPUDevice){let t=this.mlContextCache.findIndex(t=>t.gpuDevice===e);if(-1!==t)return this.mlContextCache[t].mlContext;{let t=await navigator.ml.createContext(e);return this.mlContextCache.push({gpuDevice:e,mlContext:t}),t}}if(void 0===e){let e=this.mlContextCache.findIndex(e=>void 0===e.options&&void 0===e.gpuDevice);if(-1!==e)return this.mlContextCache[e].mlContext;{let e=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:e}),e}}let t=this.mlContextCache.findIndex(t=>((e,t)=>{if(e===t)return!0;if(void 0===e||void 0===t)return!1;let r=Object.keys(e).sort(),i=Object.keys(t).sort();return r.length===i.length&&r.every((r,n)=>r===i[n]&&e[r]===t[r])})(t.options,e));if(-1!==t)return this.mlContextCache[t].mlContext;{let t=await navigator.ml.createContext(e);return this.mlContextCache.push({options:e,mlContext:t}),t}}registerMLContext(e,t){this.mlContextBySessionId.set(e,t);let r=this.sessionIdsByMLContext.get(t);r||(r=new Set,this.sessionIdsByMLContext.set(t,r)),r.add(e),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(e,this.temporaryGraphInputs),this.temporaryGraphInputs=[]),this.temporaryGraphOutputs.length>0&&(this.sessionGraphOutputs.set(e,this.temporaryGraphOutputs),this.temporaryGraphOutputs=[])}onReleaseSession(e){this.sessionGraphInputs.delete(e),this.sessionGraphOutputs.delete(e);let t=this.mlContextBySessionId.get(e);if(!t)return;this.tensorManager.releaseTensorsForSession(e),this.mlContextBySessionId.delete(e);let r=this.sessionIdsByMLContext.get(t);if(r.delete(e),0===r.size){this.sessionIdsByMLContext.delete(t);let e=this.mlContextCache.findIndex(e=>e.mlContext===t);-1!==e&&this.mlContextCache.splice(e,1)}}getMLContext(e){return this.mlContextBySessionId.get(e)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(e){e2("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${e}}`),this.tensorManager.releaseTensorId(e)}async ensureTensor(e,t,r,i,n){let o=tm.get(r);if(!o)throw Error(`Unsupported ONNX data type: ${r}`);return this.tensorManager.ensureTensor(e??this.currentSessionId,t,o,i,n)}async createTemporaryTensor(e,t,r){e2("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${t}, shape: ${r}}`);let i=tm.get(t);if(!i)throw Error(`Unsupported ONNX data type: ${t}`);let n=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(e,n,i,r,!1);let o=this.temporarySessionTensorIds.get(e);return o?o.push(n):this.temporarySessionTensorIds.set(e,[n]),n}uploadTensor(e,t){if(!eM().shouldTransferToMLTensor)throw Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");e2("verbose",()=>`[WebNN] uploadTensor {tensorId: ${e}, data: ${t.byteLength}}`),this.tensorManager.upload(e,t)}async downloadTensor(e,t){return this.tensorManager.download(e,t)}createMLTensorDownloader(e,t){return async()=>{let r=await this.tensorManager.download(e);return eQ(r,t)}}registerMLTensor(e,t,r,i){let n=tm.get(r);if(!n)throw Error(`Unsupported ONNX data type: ${r}`);let o=this.tensorManager.registerTensor(e,t,n,i);return e2("verbose",()=>`[WebNN] registerMLTensor {tensor: ${t}, dataType: ${n}, dimensions: ${i}} -> {tensorId: ${o}}`),o}registerMLConstant(e,t,r,i,n,o,s=!1){if(!o)throw Error("External mounted files are not available.");let u=e;e.startsWith("./")&&(u=e.substring(2));let l=o.get(u);if(!l)throw Error(`File with name ${u} not found in preloaded files.`);if(t+r>l.byteLength)throw Error("Out of bounds: data offset and length exceed the external file data size.");let f=l.slice(t,t+r).buffer,d;switch(n.dataType){case"float32":d=new Float32Array(f);break;case"float16":d="u">typeof Float16Array&&Float16Array.from?new Float16Array(f):new Uint16Array(f);break;case"int32":d=new Int32Array(f);break;case"uint32":d=new Uint32Array(f);break;case"int64":s?(d=new Int32Array(e4(new Uint8Array(f),"int64").buffer),n.dataType="int32"):d=new BigInt64Array(f);break;case"uint64":d=new BigUint64Array(f);break;case"int8":d=new Int8Array(f);break;case"int4":case"uint4":case"uint8":d=new Uint8Array(f);break;default:throw Error(`Unsupported data type: ${n.dataType} in creating WebNN Constant from external data.`)}return e2("verbose",()=>`[WebNN] registerMLConstant {dataType: ${n.dataType}, shape: ${n.shape}}} ${s?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),i.constant(n,d)}registerGraphInput(e){this.temporaryGraphInputs.push(e)}registerGraphOutput(e){this.temporaryGraphOutputs.push(e)}isGraphInput(e,t){let r=this.sessionGraphInputs.get(e);return!!r&&r.includes(t)}isGraphOutput(e,t){let r=this.sessionGraphOutputs.get(e);return!!r&&r.includes(t)}isGraphInputOutputTypeSupported(e,t,r=!0){let i=this.mlContextBySessionId.get(e),n=tm.get(eG(t));return!(typeof n>"u")&&(r?!!i?.opSupportLimits().input.dataTypes.includes(n):!!i?.opSupportLimits().output.dataTypes.includes(n))}flush(){}}}),tQ=N(()=>{"use strict";eu(),tu(),tl(),tf(),to(),ts(),td(),tb=async e=>{var t,r;t=e.wasm.numThreads,r=eH(e.logLevel),0!==eM()._OrtInit(t,r)&&eP("Can't initialize onnxruntime.")},tw=async(e,t)=>{eM().asyncInit?.();let r=e.webgpu.adapter;if("webgpu"===t){if(typeof navigator>"u"||!navigator.gpu)throw Error("WebGPU is not supported in current environment");if(r){if("object"!=typeof r.limits||"object"!=typeof r.features||"function"!=typeof r.requestDevice)throw Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let t=e.webgpu.powerPreference;if(void 0!==t&&"low-power"!==t&&"high-performance"!==t)throw Error(`Invalid powerPreference setting: "${t}"`);let i=e.webgpu.forceFallbackAdapter;if(void 0!==i&&"boolean"!=typeof i)throw Error(`Invalid forceFallbackAdapter setting: "${i}"`);if(!(r=await navigator.gpu.requestAdapter({powerPreference:t,forceFallbackAdapter:i})))throw Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}}if("webnn"===t&&(typeof navigator>"u"||!navigator.ml))throw Error("WebNN is not supported in current environment");if("webgpu"===t&&eM().webgpuInit(t=>{e.webgpu.device=t}),"webnn"===t){let t=new(tX(),G(ty)).WebNNBackend(e);eM().webnnInit([t,()=>t.reserveTensorId(),e=>t.releaseTensorId(e),async(e,r,i,n,o)=>t.ensureTensor(e,r,i,n,o),(e,r)=>{t.uploadTensor(e,r)},async(e,r)=>t.downloadTensor(e,r),(e,r)=>t.registerMLContext(e,r),!!e.trace])}},tv=new Map,tC=(e,t)=>{let r=eM(),i=r.stackSave(),n=0;try{let i=r.PTR_SIZE,o=r.stackAlloc(2*i);0!==r._OrtGetInputOutputMetadata(e,t,o,o+i)&&eP("Can't get session input/output metadata.");let s=Number(r.getValue(o,"*"));n=Number(r.getValue(o+i,"*"));let u=r.HEAP32[n/4];if(0===u)return[s,0];let l=r.HEAPU32[n/4+1],f=[];for(let e=0;e<l;e++){let t=Number(r.getValue(n+8+e*i,"*"));f.push(0!==t?r.UTF8ToString(t):Number(r.getValue(n+8+(e+l)*i,"*")))}return[s,u,f]}finally{r.stackRestore(i),0!==n&&r._OrtFree(n)}},tT=e=>{let t=eM(),r=t._malloc(e.byteLength);if(0===r)throw Error(`Can't create a session. failed to allocate a buffer of size ${e.byteLength}.`);return t.HEAPU8.set(e,r),[r,e.byteLength]},t_=async(e,t)=>{let r,i,n=eM();Array.isArray(e)?[r,i]=e:e.buffer===n.HEAPU8.buffer?[r,i]=[e.byteOffset,e.byteLength]:[r,i]=tT(e);let o=0,s=0,u=0,l=[],f=[],d=[];try{if([s,l]=await eW(t),t?.externalData&&n.mountExternalData){let e=[];for(let r of t.externalData){let t="string"==typeof r?r:r.path;e.push(eX("string"==typeof r?r:r.data).then(e=>{n.mountExternalData(t,e)}))}await Promise.all(e)}for(let e of t?.executionProviders??[])if(("string"==typeof e?e:e.name)==="webnn"){if(n.shouldTransferToMLTensor=!1,"string"!=typeof e){let t=e?.context,r=e?.gpuDevice,i=e?.deviceType,o=e?.powerPreference;t?n.currentContext=t:r?n.currentContext=await n.webnnCreateMLContext(r):n.currentContext=await n.webnnCreateMLContext({deviceType:i,powerPreference:o})}else n.currentContext=await n.webnnCreateMLContext();break}o=await n._OrtCreateSession(r,i,s),n.webgpuOnCreateSession?.(o),0===o&&eP("Can't create a session."),n.jsepOnCreateSession?.(),n.currentContext&&(n.webnnRegisterMLContext(o,n.currentContext),n.currentContext=void 0,n.shouldTransferToMLTensor=!0);let[e,c]=(e=>{let t=eM(),r=t.stackSave();try{let r=t.PTR_SIZE,i=t.stackAlloc(2*r);0!==t._OrtGetInputOutputCount(e,i,i+r)&&eP("Can't get session input/output count.");let n=4===r?"i32":"i64";return[Number(t.getValue(i,n)),Number(t.getValue(i+r,n))]}finally{t.stackRestore(r)}})(o),p=!!t?.enableGraphCapture,h=[],y=[],m=[],g=[],b=[];for(let t=0;t<e;t++){let[e,r,i]=tC(o,t);0===e&&eP("Can't get an input name."),f.push(e);let s=n.UTF8ToString(e);h.push(s),m.push(0===r?{name:s,isTensor:!1}:{name:s,isTensor:!0,type:eF(r),shape:i})}for(let r=0;r<c;r++){let[i,s,u]=tC(o,r+e);0===i&&eP("Can't get an output name."),d.push(i);let l=n.UTF8ToString(i);y.push(l),g.push(0===s?{name:l,isTensor:!1}:{name:l,isTensor:!0,type:eF(s),shape:u});{if(p&&t?.preferredOutputLocation===void 0){b.push("gpu-buffer");continue}let e="string"==typeof t?.preferredOutputLocation?t.preferredOutputLocation:t?.preferredOutputLocation?.[l]??"cpu",r=n.webnnIsGraphOutput;if("cpu"===e&&r&&r(o,l)){b.push("ml-tensor-cpu-output");continue}if("cpu"!==e&&"cpu-pinned"!==e&&"gpu-buffer"!==e&&"ml-tensor"!==e)throw Error(`Not supported preferred output location: ${e}.`);if(p&&"gpu-buffer"!==e)throw Error(`Not supported preferred output location: ${e}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);b.push(e)}}let w=null;return b.some(e=>"gpu-buffer"===e||"ml-tensor"===e||"ml-tensor-cpu-output"===e)&&(u=n._OrtCreateBinding(o),0===u&&eP("Can't create IO binding."),w={handle:u,outputPreferredLocations:b,outputPreferredLocationsEncoded:b.map(e=>"ml-tensor-cpu-output"===e?"ml-tensor":e).map(e=>eZ(e))}),tv.set(o,[o,f,d,w,p,!1]),[o,h,y,m,g]}catch(e){throw f.forEach(e=>n._OrtFree(e)),d.forEach(e=>n._OrtFree(e)),0!==u&&0!==n._OrtReleaseBinding(u)&&eP("Can't release IO binding."),0!==o&&0!==n._OrtReleaseSession(o)&&eP("Can't release session."),e}finally{n._free(r),0!==s&&0!==n._OrtReleaseSessionOptions(s)&&eP("Can't release session options."),l.forEach(e=>n._free(e)),n.unmountExternalData?.()}},tE=e=>{let t=eM(),r=tv.get(e);if(!r)throw Error(`cannot release session. invalid session id: ${e}`);let[i,n,o,s,u]=r;s&&(u&&0!==t._OrtClearBoundOutputs(s.handle)&&eP("Can't clear bound outputs."),0!==t._OrtReleaseBinding(s.handle)&&eP("Can't release IO binding.")),t.jsepOnReleaseSession?.(e),t.webnnOnReleaseSession?.(e),t.webgpuOnReleaseSession?.(e),n.forEach(e=>t._OrtFree(e)),o.forEach(e=>t._OrtFree(e)),0!==t._OrtReleaseSession(i)&&eP("Can't release session."),tv.delete(e)},tx=async(e,t,r,i,n,o,s=!1)=>{if(!e)return void t.push(0);let u=eM(),l=u.PTR_SIZE,f=e[0],d=e[1],c=e[3],p=c,h,y;if("string"===f&&("gpu-buffer"===c||"ml-tensor"===c))throw Error("String tensor is not supported on GPU.");if(s&&"gpu-buffer"!==c)throw Error(`External buffer must be provided for input/output index ${o} when enableGraphCapture is true.`);if("gpu-buffer"===c){let t=e[2].gpuBuffer;y=eV(eG(f),d);{let e=u.webgpuRegisterBuffer;if(!e)throw Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');h=e(t,i)}}else if("ml-tensor"===c){let t=e[2].mlTensor;y=eV(eG(f),d);let r=u.webnnRegisterMLTensor;if(!r)throw Error('Tensor location "ml-tensor" is not supported without using WebNN.');h=r(i,t,eG(f),d)}else{let t=e[2];if(Array.isArray(t)){y=l*t.length,h=u._malloc(y),r.push(h);for(let e=0;e<t.length;e++){if("string"!=typeof t[e])throw TypeError(`tensor data at index ${e} is not a string`);u.setValue(h+e*l,ej(t[e],r),"*")}}else{let e=u.webnnIsGraphInput,o=u.webnnIsGraphOutput;if("string"!==f&&e&&o){let s=u.UTF8ToString(n);if(e(i,s)||o(i,s)){let e=eG(f);y=eV(e,d),p="ml-tensor";let r=u.webnnCreateTemporaryTensor,n=u.webnnUploadTensor;if(!r||!n)throw Error('Tensor location "ml-tensor" is not supported without using WebNN.');let o=await r(i,e,d);n(o,new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),h=o}else y=t.byteLength,h=u._malloc(y),r.push(h),u.HEAPU8.set(new Uint8Array(t.buffer,t.byteOffset,y),h)}else y=t.byteLength,h=u._malloc(y),r.push(h),u.HEAPU8.set(new Uint8Array(t.buffer,t.byteOffset,y),h)}}let m=u.stackSave(),g=u.stackAlloc(4*d.length);try{d.forEach((e,t)=>u.setValue(g+t*l,e,4===l?"i32":"i64"));let e=u._OrtCreateTensor(eG(f),h,y,g,d.length,eZ(p));0===e&&eP(`Can't create tensor for input/output. session=${i}, index=${o}.`),t.push(e)}finally{u.stackRestore(m)}},tA=async(e,t,r,i,n,o)=>{let s=eM(),u=s.PTR_SIZE,l=tv.get(e);if(!l)throw Error(`cannot run inference. invalid session id: ${e}`);let f=l[0],d=l[1],c=l[2],p=l[3],h=l[4],y=l[5],m=t.length,g=i.length,b=0,w=[],v=[],C=[],T=[],_=s.stackSave(),E=s.stackAlloc(m*u),x=s.stackAlloc(m*u),A=s.stackAlloc(g*u),O=s.stackAlloc(g*u);try{let l;[b,w]=e$(o),L("wasm prepareInputOutputTensor");for(let i=0;i<m;i++)await tx(r[i],v,T,e,d[t[i]],t[i],h);for(let t=0;t<g;t++)await tx(n[t],C,T,e,c[i[t]],m+i[t],h);P("wasm prepareInputOutputTensor");for(let e=0;e<m;e++)s.setValue(E+e*u,v[e],"*"),s.setValue(x+e*u,d[t[e]],"*");for(let e=0;e<g;e++)s.setValue(A+e*u,C[e],"*"),s.setValue(O+e*u,c[i[e]],"*");if(p&&!y){let{handle:r,outputPreferredLocations:o,outputPreferredLocationsEncoded:u}=p;if(d.length!==m)throw Error(`input count from feeds (${m}) is expected to be always equal to model's input count (${d.length}).`);L("wasm bindInputsOutputs");for(let i=0;i<m;i++){let n=t[i];await s._OrtBindInput(r,d[n],v[i])!==0&&eP(`Can't bind input[${i}] for session=${e}.`)}for(let t=0;t<g;t++){let l=i[t];n[t]?.[3]?0!==s._OrtBindOutput(r,c[l],C[t],0)&&eP(`Can't bind pre-allocated output[${t}] for session=${e}.`):0!==s._OrtBindOutput(r,c[l],0,u[l])&&eP(`Can't bind output[${t}] to ${o[t]} for session=${e}.`)}P("wasm bindInputsOutputs"),tv.set(e,[f,d,c,p,h,!0])}s.jsepOnRunStart?.(f),s.webnnOnRunStart?.(f),l=p?await s._OrtRunWithBinding(f,p.handle,g,A,b):await s._OrtRun(f,x,E,m,O,g,A,b),0!==l&&eP("failed to call OrtRun().");let _=[],I=[];L("wasm ProcessOutputTensor");for(let t=0;t<g;t++){let r=Number(s.getValue(A+t*u,"*"));if(r===C[t]){_.push(n[t]);continue}let o=s.stackSave(),l=s.stackAlloc(4*u),f=!1,d,c=0;try{0!==s._OrtGetTensorData(r,l,l+u,l+2*u,l+3*u)&&eP(`Can't access output tensor data on index ${t}.`);let n=4===u?"i32":"i64",o=Number(s.getValue(l,n));c=s.getValue(l+u,"*");let h=s.getValue(l+2*u,"*"),y=Number(s.getValue(l+3*u,n)),m=[];for(let e=0;e<y;e++)m.push(Number(s.getValue(h+e*u,n)));0!==s._OrtFree(h)&&eP("Can't free memory for tensor dims.");let g=m.reduce((e,t)=>e*t,1);d=eF(o);let b=p?.outputPreferredLocations[i[t]];if("string"===d){if("gpu-buffer"===b||"ml-tensor"===b)throw Error("String tensor is not supported on GPU.");let e=[];for(let t=0;t<g;t++){let r=s.getValue(c+t*u,"*"),i=s.getValue(c+(t+1)*u,"*"),n=t===g-1?void 0:i-r;e.push(s.UTF8ToString(r,n))}_.push([d,m,e,"cpu"])}else if("gpu-buffer"===b&&g>0){let t=s.webgpuGetBuffer;if(!t)throw Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let i=t(c),n=eV(o,g);if(void 0===n||!eq(d))throw Error(`Unsupported data type: ${d}`);f=!0;{s.webgpuRegisterBuffer(i,e,c);let t=s.webgpuCreateDownloader(i,n,e);_.push([d,m,{gpuBuffer:i,download:async()=>{let e=await t();return new(ez(d))(e)},dispose:()=>{0!==s._OrtReleaseTensor(r)&&eP("Can't release tensor.")}},"gpu-buffer"])}}else if("ml-tensor"===b&&g>0){let t=s.webnnEnsureTensor,i=s.webnnIsGraphInputOutputTypeSupported;if(!t||!i)throw Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(void 0===eV(o,g)||!eY(d))throw Error(`Unsupported data type: ${d}`);if(!i(e,d,!1))throw Error(`preferredLocation "ml-tensor" for ${d} output is not supported by current WebNN Context.`);let n=await t(e,c,o,m,!1);f=!0,_.push([d,m,{mlTensor:n,download:s.webnnCreateMLTensorDownloader(c,d),dispose:()=>{s.webnnReleaseTensorId(c),s._OrtReleaseTensor(r)}},"ml-tensor"])}else if("ml-tensor-cpu-output"===b&&g>0){let e=s.webnnCreateMLTensorDownloader(c,d)(),t=_.length;f=!0,I.push((async()=>{let i=[t,await e];return s.webnnReleaseTensorId(c),s._OrtReleaseTensor(r),i})()),_.push([d,m,[],"cpu"])}else{let e=new(ez(d))(g);new Uint8Array(e.buffer,e.byteOffset,e.byteLength).set(s.HEAPU8.subarray(c,c+e.byteLength)),_.push([d,m,e,"cpu"])}}finally{s.stackRestore(o),"string"===d&&c&&s._free(c),f||s._OrtReleaseTensor(r)}}for(let[t,r]of(p&&!h&&(0!==s._OrtClearBoundOutputs(p.handle)&&eP("Can't clear bound outputs."),tv.set(e,[f,d,c,p,h,!1])),await Promise.all(I)))_[t][2]=r;return P("wasm ProcessOutputTensor"),_}finally{s.webnnOnRunEnd?.(f),s.stackRestore(_),r.forEach(e=>{e&&"gpu-buffer"===e[3]&&s.webgpuUnregisterBuffer(e[2].gpuBuffer)}),n.forEach(e=>{e&&"gpu-buffer"===e[3]&&s.webgpuUnregisterBuffer(e[2].gpuBuffer)}),v.forEach(e=>s._OrtReleaseTensor(e)),C.forEach(e=>s._OrtReleaseTensor(e)),T.forEach(e=>s._free(e)),0!==b&&s._OrtReleaseRunOptions(b),w.forEach(e=>s._free(e))}},tO=e=>{let t=eM(),r=tv.get(e);if(!r)throw Error("invalid session id");let i=r[0],n=t._OrtEndProfiling(i);0===n&&eP("Can't get an profile file name."),t._OrtFree(n)},tI=e=>{let t=[];for(let r of e){let e=r[2];!Array.isArray(e)&&"buffer"in e&&t.push(e.buffer)}return t}}),tK=N(()=>{"use strict";eu(),tQ(),to(),ta(),tS=()=>!!h.wasm.proxy&&"u">typeof document,tB=!1,tR=!1,tM=!1,tP=new Map,t$=(e,t)=>{let r=tP.get(e);r?r.push(t):tP.set(e,[t])},tk=()=>{if(tB||!tR||tM||!tU)throw Error("worker not ready")},tD=e=>{switch(e.data.type){case"init-wasm":tB=!1,e.data.err?(tM=!0,tL[1](e.data.err)):(tR=!0,tL[0]()),tj&&(URL.revokeObjectURL(tj),tj=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let t=tP.get(e.data.type);e.data.err?t.shift()[1](e.data.err):t.shift()[0](e.data.out)}}},tN=async()=>{if(!tR){if(tB)throw Error("multiple calls to 'initWasm()' detected.");if(tM)throw Error("previous call to 'initWasm()' failed.");if(tB=!0,tS())return new Promise((e,t)=>{tU?.terminate(),ex().then(([r,i])=>{try{(tU=i).onerror=e=>t(e),tU.onmessage=tD,tL=[e,t];let n={type:"init-wasm",in:h};!n.in.wasm.wasmPaths&&(r||eb)&&(n.in.wasm.wasmPaths={wasm:new URL("ort-wasm-simd-threaded.asyncify.wasm",import.meta.url).href}),tU.postMessage(n),tj=r}catch(e){t(e)}},t)});try{await eR(h.wasm),await tb(h),tR=!0}catch(e){throw tM=!0,e}finally{tB=!1}}},tW=async e=>{if(tS())return tk(),new Promise((t,r)=>{t$("init-ep",[t,r]);let i={type:"init-ep",in:{epName:e,env:h}};tU.postMessage(i)});await tw(h,e)},tG=async e=>tS()?(tk(),new Promise((t,r)=>{t$("copy-from",[t,r]),tU.postMessage({type:"copy-from",in:{buffer:e}},[e.buffer])})):tT(e),tF=async(e,t)=>{if(!tS())return t_(e,t);if(t?.preferredOutputLocation)throw Error('session option "preferredOutputLocation" is not supported for proxy.');return tk(),new Promise((r,i)=>{t$("create",[r,i]);let n={type:"create",in:{model:e,options:{...t}}},o=[];e instanceof Uint8Array&&o.push(e.buffer),tU.postMessage(n,o)})},tV=async e=>{if(tS())return tk(),new Promise((t,r)=>{t$("release",[t,r]),tU.postMessage({type:"release",in:e})});tE(e)},tz=async(e,t,r,i,n,o)=>{if(!tS())return tA(e,t,r,i,n,o);if(r.some(e=>"cpu"!==e[3]))throw Error("input tensor on GPU is not supported for proxy.");if(n.some(e=>e))throw Error("pre-allocated output tensor is not supported for proxy.");return tk(),new Promise((n,s)=>{t$("run",[n,s]),tU.postMessage({type:"run",in:{sessionId:e,inputIndices:t,inputs:r,outputIndices:i,options:o}},tI(r))})},tH=async e=>{if(tS())return tk(),new Promise((t,r)=>{t$("end-profiling",[t,r]),tU.postMessage({type:"end-profiling",in:e})});tO(e)}}),tJ=N(()=>{"use strict";eu(),tK(),tf(),el(),td(),tq=(e,t)=>{switch(e.location){case"cpu":return[e.type,e.dims,e.data,"cpu"];case"gpu-buffer":return[e.type,e.dims,{gpuBuffer:e.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[e.type,e.dims,{mlTensor:e.mlTensor},"ml-tensor"];default:throw Error(`invalid data location: ${e.location} for ${t()}`)}},tY=e=>{switch(e[3]){case"cpu":return new U(e[0],e[2],e[1]);case"gpu-buffer":{let t=e[0];if(!eq(t))throw Error(`not supported data type: ${t} for deserializing GPU tensor`);let{gpuBuffer:r,download:i,dispose:n}=e[2];return U.fromGpuBuffer(r,{dataType:t,dims:e[1],download:i,dispose:n})}case"ml-tensor":{let t=e[0];if(!eY(t))throw Error(`not supported data type: ${t} for deserializing MLTensor tensor`);let{mlTensor:r,download:i,dispose:n}=e[2];return U.fromMLTensor(r,{dataType:t,dims:e[1],download:i,dispose:n})}default:throw Error(`invalid data location: ${e[3]}`)}},tZ=class{async fetchModelAndCopyToWasmMemory(e){return tG(await eX(e))}async loadModel(e,t){let r;M(),r="string"==typeof e?await this.fetchModelAndCopyToWasmMemory(e):e,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await tF(r,t),j()}async dispose(){return tV(this.sessionId)}async run(e,t,r){M();let i=[],n=[];Object.entries(e).forEach(e=>{let t=e[0],r=e[1],o=this.inputNames.indexOf(t);if(-1===o)throw Error(`invalid input '${t}'`);i.push(r),n.push(o)});let o=[],s=[];Object.entries(t).forEach(e=>{let t=e[0],r=e[1],i=this.outputNames.indexOf(t);if(-1===i)throw Error(`invalid output '${t}'`);o.push(r),s.push(i)});let u=i.map((e,t)=>tq(e,()=>`input "${this.inputNames[n[t]]}"`)),l=o.map((e,t)=>e?tq(e,()=>`output "${this.outputNames[s[t]]}"`):null),f=await tz(this.sessionId,n,u,s,l,r),d={};for(let e=0;e<f.length;e++)d[this.outputNames[s[e]]]=o[e]??tY(f[e]);return j(),d}startProfiling(){}endProfiling(){tH(this.sessionId)}}}),t0={};W(t0,{OnnxruntimeWebAssemblyBackend:()=>t2,initializeFlags:()=>t1,wasmBackend:()=>t3});var t1,t2,t3,t4=N(()=>{"use strict";eu(),tK(),tJ(),t1=()=>{("number"!=typeof h.wasm.initTimeout||h.wasm.initTimeout<0)&&(h.wasm.initTimeout=0);let e=h.wasm.simd;if("boolean"!=typeof e&&void 0!==e&&"fixed"!==e&&"relaxed"!==e&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${e}". Reset it to \`false\` and ignore SIMD feature checking.`),h.wasm.simd=!1),"boolean"!=typeof h.wasm.proxy&&(h.wasm.proxy=!1),"boolean"!=typeof h.wasm.trace&&(h.wasm.trace=!1),"number"!=typeof h.wasm.numThreads||!Number.isInteger(h.wasm.numThreads)||h.wasm.numThreads<=0)if("u">typeof self&&!self.crossOriginIsolated)h.wasm.numThreads=1;else{let e=typeof navigator>"u"?D("node:os").cpus().length:navigator.hardwareConcurrency;h.wasm.numThreads=Math.min(4,Math.ceil((e||1)/2))}},t3=new(t2=class{async init(e){t1(),await tN(),await tW(e)}async createInferenceSessionHandler(e,t){let r=new tZ;return await r.loadModel(e,t),r}})});eu(),eu(),eu();var t6=es;{let e=(t4(),G(t0)).wasmBackend;u("webgpu",e,5),u("webnn",e,5),u("cpu",e,10),u("wasm",e,10)}Object.defineProperty(h.versions,"web",{value:"1.23.2",enumerable:!0});export{k as InferenceSession,B as TRACE,L as TRACE_EVENT_BEGIN,P as TRACE_EVENT_END,M as TRACE_FUNC_BEGIN,j as TRACE_FUNC_END,U as Tensor,t6 as default,h as env,u as registerBackend};